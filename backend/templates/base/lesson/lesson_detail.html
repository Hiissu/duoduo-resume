{% extends 'base/main.html' %}
{% load static %}
{% block content %}

<style>
    .ts {
        /* #2f3136 more dark   #202225 moremore dark*/
        table-layout: fixed;
        background-color: #2f3136;
    }

    .custom-input,
    .custom-select {
        background-color: #40444b;
        color: white
    }

    .custom-input:focus,
    .custom-select:focus {
        background-color: #40444b;
        color: white
    }

    .ei {
        cursor: pointer;
        margin-right: 22px;
    }

    .eina {
        cursor: not-allowed;
        margin-right: 22px;
        opacity: 0.5;
    }

    svg {
        color: white;
    }

    table {
        table-layout: fixed;
    }

    .search-tr {
        height: 69px;
        text-align: center;
    }

    td {
        white-space: normal !important;
        word-wrap: break-word;
    }

    input[type=search]::-webkit-search-cancel-button {
        -webkit-appearance: searchfield-cancel-button;
    }

    #search-overlay,
    #wt-overlay,
    #ewts-overlay {
        overflow-y: scroll;
        height: 100%;
        width: 100%;
        display: none;
        position: fixed;
        z-index: 2;
        top: 0;
        left: 0;
        /* background-color: rgba(8, 9, 10, 0.85); */
        background-color: rgba(16, 16, 17, 0.85);
        /* backdrop-filter: blur(2px); */
    }

    #cf-overlay,
    #rp-overlay {
        height: 100%;
        width: 100%;
        display: none;
        position: fixed;
        z-index: 3;
        top: 0;
        left: 0;
        background-color: rgba(16, 16, 17, 0.85);
    }


    #uorc-overlay {
        height: 100%;
        width: 100%;
        display: none;
        position: fixed;
        z-index: 2;
        top: 0;
        left: 0;
        background-color: rgba(16, 16, 17, 0.85);
    }

    #search-overlay-content {
        position: relative;
        top: 16%;
        width: 68%;
        padding: 56px;
        padding-top: 12px;
        padding-bottom: 40px;
        margin: auto;
        color: white;
        background-color: #36393f;
        opacity: 1;
        z-index: 3;
    }

    #ewts-overlay-content {
        position: relative;
        top: 16%;
        width: 86%;
        padding: 20px;
        padding-top: 12px;
        margin: auto;
        color: white;
        background-color: #36393f;
        opacity: 1;
        z-index: 3;
    }

    #wt-overlay-content {
        position: relative;
        top: 56px;
        width: 567px;
        padding: 20px;
        margin: auto;
        color: white;
        background-color: #36393f;
        opacity: 1;
        z-index: 3;
    }

    #cf-overlay-content,
    #rp-overlay-content,
    #uorc-overlay-content {
        position: relative;
        top: 234px;
        width: 456px;
        padding: 20px;
        margin: auto;
        color: white;
        background-color: #36393f;
        opacity: 1;
        z-index: 2;
    }

    .tultip {
        position: relative;
        display: inline-block;
        /* border-bottom: 1px dotted black; */
    }

    /* Tooltip position */
    .tultip .tultip-content {
        visibility: hidden;
        background-color: black;
        text-align: center;
        border-radius: 6px;
        padding: 5px 0;
        position: absolute;
        z-index: 1;
        bottom: 28px;
        left: 50%;
        width: 120px;
        /* Use half of the width (120/2 = 60), to center the tooltip */
        margin-left: -60px;
    }

    /* Tooltip arrow */
    .tultip .tultip-content::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: black transparent transparent transparent;
    }

    .tultip .left-tultip-content {
        visibility: hidden;
        width: 120px;
        background-color: black;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px 0;
        position: absolute;
        z-index: 1;
        top: -5px;
        right: 110%;
    }

    .tultip .left-tultip-content::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 100%;
        margin-top: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: transparent transparent transparent black;
    }

    .tultip:hover .tultip-content,
    .tultip:hover .left-tultip-content {
        visibility: visible;
    }
</style>

<link rel="stylesheet" type="text/css" href="{% static '/css/lesson_detail.css' %}">
<!-- ~ https://www.w3schools.com/bootstrap4/bootstrap_forms.asp validation for all -->

<!-- Searh overlay -->
<div id="search-overlay">
    <div id="search-overlay-content">
        <div>
            <div style="width: -webkit-fill-available; text-align: center;">
                <span><strong style="font-size: large; margin-right: 1%;">Find your</strong></span>
                <button id="srch-word-btn" class="btn btn-outline-secondary">Word</button>
                <!-- <button id="srch-word-byText-btn" class="btn btn-outline-secondary">Search Word by Text</button> -->
                <button id="srch-phrase-btn" class="btn btn-outline-secondary">Phrase</button>
                <button id="srch-sentence-btn" class="btn btn-outline-secondary">Sentence</button>
                <div style="margin-top: 2%; color: #4f5660;">
                    Build your own lesson on DuoDuo. Focus on what you want to learn.</div>
            </div>
            <div style="cursor:pointer; position: fixed; top: 18%; right: 18%;">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"
                    class="close-search-overlay-btn bi bi-x-circle" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                    <path
                        d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                </svg>
                <div style="font-size: small;">ESC</div>
            </div>
        </div>
        <br>

        <!-- Word overlay section -->
        <div id="search-word-section" style="display: none;">
            <div class="form-group">
                <div class="input-group mb-3">
                    <input id="search-word-input" class="form-control custom-input" type="search"
                        placeholder="Search Word" autocomplete="off" required>
                    <div class="input-group-text">
                        <small>"Enter" to Search</small>
                    </div>
                    <button id="search-word-btn" class=" input-group-append btn btn-outline-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                            class="bi bi-search" viewBox="0 0 16 16">
                            <path
                                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                        </svg>
                    </button>
                </div>
            </div>
            <div id="word-search-alert"></div>
            <div id="word-search-announce" style="display: none;">
                <div class="form-row">
                    <div class="col" style="color: #4f5660;">
                        <p>This course does not have any {{course_learning.language_learning}} word like
                            <strong class="ws-word"></strong>.
                        </p>
                        <p>Do you still want to add new word <strong class="ws-word"></strong> to your lesson? Cause it
                            is a new word so you need to create a {{course_learning.language_speaking}}
                            translation for <strong class="ws-word"></strong>.
                        </p>
                        <p>
                            <small>
                                You can add 3 new words per day.
                                <span id="wadd-times" title="number of times left" style="margin-left: 10px;"></span>/3
                                <span class="timer-countdown" title="till new day according server time"
                                    style="margin-left: 10px;"></span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-hourglass-split" viewBox="0 0 16 16">
                                    <path
                                        d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1h-11zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2h-7zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48V8.35zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z" />
                                </svg>
                            </small>
                        </p>
                        <small class="text-danger">
                            * If you add too many new words which are not {{course_learning.language_learning}} word,
                            you might lose your ability to add new word.
                        </small>
                    </div>
                    <div>
                        <button id="cnew-wt-btn" class="btn btn-secondary"
                            style="width: 170px; height: 40px; margin-right: 6px;">
                            Create Translation
                        </button>
                    </div>
                </div>
                <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
                <div class="form-row">
                    <div class="col" style="color: #4f5660;">
                        <p>If you are not in a rush. Let's send a request with your word/list of words to channel
                            <strong>#rq-new-word</strong> on our Discord.
                        </p>
                    </div>
                    <button id="rqnew-word-btn" class="btn btn-secondary"
                        style="width: 170px; height: 40px; margin-right: 6px;">
                        Request New Word
                    </button>
                </div>
            </div>
            <div class="table-responsive" id="word-matched">
                <table id="word-stable" class="table">
                    <thead>
                        <tr>
                            <th style="text-align: center;">{{course_learning.language_learning}} Word</th>
                            <th></th>
                            <th style="width: 12%;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for word in words_list %}
                        <tr data-word-str-id="{{word.word_id}}" data-word="{{word.word}}" class="search-tr">
                            <td>
                                <div>{{word.word}}</div>
                            </td>
                            {% if word.is_learning %}
                            <td>
                                <div data-word="{{word.word}}" data-word-id="{{word.word_id}}"
                                    class="sremove-word ei tultip">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-x-lg text-danger" viewBox="0 0 16 16">
                                        <path
                                            d="M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z" />
                                    </svg>
                                    <span class="tultip-content" style="width: 142px; margin-left: -71px;">
                                        Remove Word</span>
                                </div>
                            </td>
                            {% else %}
                            <td>
                                <div data-word="{{word.word}}" data-word-id="{{word.word_id}}"
                                    class="sadd-word ei tultip">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-plus-lg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                            d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"
                                            fill="#000" />
                                    </svg>
                                    <span class="tultip-content" style="width: 142px; margin-left: -71px;">
                                        Add Word</span>
                                </div>
                            </td>
                            {% endif %}
                            <td>
                                <div class="sreport-word ei tultip" style="display: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-flag" viewBox="0 0 16 16">
                                        <path
                                            d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21.294 21.294 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.29 9.86 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21.317 21.317 0 0 0 14 7.655V1.222z" />
                                    </svg>
                                    <span class="tultip-content" style="width: 142px; margin-left: -71px;">Report
                                        Word</span>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Phrase overlay section -->
        <div id="search-phrase-section" style="display: none;">
            <div class="form-group">
                <div class="input-group mb-3">
                    <input id="search-phrase-input" class="form-control custom-input" type="search"
                        placeholder="Search Phrase" autocomplete="off">
                    <div class="input-group-text">
                        <small>"Enter" to Search</small>
                    </div>
                    <button id="search-phrase-btn" class="input-group-append btn btn-outline-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                            class="bi bi-search" viewBox="0 0 16 16">
                            <path
                                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                        </svg>
                    </button>
                </div>
            </div>
            <div id="phrase-search-alert"></div>
            <div id="phrase-search-announce" style="display: none;">
                <div class="form-row">
                    <div class="col" style="color: #4f5660;">
                        <p>This course does not have any {{course_learning.language_learning}} phrase like
                            <strong class="ps-phrase"></strong>.
                        </p>
                        <p>Do you still want to add new phrase <strong class="ps-phrase"></strong> to your lesson? Cause
                            it
                            is a new phrase so you need to create a {{course_learning.language_speaking}}
                            translation for <strong class="ps-phrase"></strong>.
                        </p>
                        <p>
                            <small>
                                You can add three new phrases per day.
                                <span id="padd-times" title="number of times left" style="margin-left: 10px;"></span>/3
                                <span class="timer-countdown" title="till new day according server time"
                                    style="margin-left: 10px;"></span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-hourglass-split" viewBox="0 0 16 16">
                                    <path
                                        d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1h-11zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2h-7zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48V8.35zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z" />
                                </svg>
                            </small>
                        </p>
                        <small class="text-danger">
                            * If you add too many new phrases which are not {{course_learning.language_learning}}
                            phrase,
                            you might lose your ability to add new phrase.
                        </small>
                    </div>
                    <div>
                        <button id="cnew-pt-btn" class="btn btn-secondary"
                            style="width: 170px; height: 40px; margin-right: 6px;">
                            Create Translation
                        </button>
                    </div>
                </div>
                <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
                <div class="form-row">
                    <div class="col" style="color: #4f5660;">
                        <p>If you are not in a rush. Let's send a request with your phrase/list of phrases to channel
                            <strong>#rq-new-phrase</strong> on our Discord.
                        </p>
                    </div>
                    <button id="rqnew-phrase-btn" class="btn btn-secondary"
                        style="width: 170px; height: 40px; margin-right: 6px;">
                        Request New Phrase
                    </button>
                </div>
            </div>
            <div class="table-responsive" id="phrase-matched" style="display: none;">
                <table id="phrase-stable" class="table">
                    <thead>
                        <tr>
                            <th style="text-align: center;">{{course_learning.language_learning}} Phrase</th>
                            <th></th>
                            <th style="width: 12%;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for phrase in phrases_list %}
                        <tr data-phrase-str-id="{{phrase.phrase_id}}" data-phrase="{{phrase.phrase}}" class="search-tr">
                            <td>
                                <div>{{phrase.phrase}}</div>
                            </td>
                            {% if phrase.is_learning %}
                            <td>
                                <div data-phrase="{{phrase.phrase}}" data-phrase-id="{{phrase.phrase_id}}"
                                    class="sremove-phrase ei tultip">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-x-lg text-danger" viewBox="0 0 16 16">
                                        <path
                                            d="M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z" />
                                    </svg>
                                    <span class="tultip-content" style="width: 142px; margin-left: -71px;">
                                        Remove Phrase</span>
                                </div>
                            </td>
                            {% else %}
                            <td>
                                <div data-phrase="{{phrase.phrase}}" data-phrase-id="{{phrase.phrase_id}}"
                                    class="sadd-phrase ei tultip">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-plus-lg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                            d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"
                                            fill="#000" />
                                    </svg>
                                    <span class="tultip-content" style="width: 142px; margin-left: -71px;">
                                        Add Phrase</span>
                                </div>
                            </td>
                            {% endif %}
                            <td>
                                <div class="sreport-phrase ei tultip" style="display: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                        class="bi bi-flag" viewBox="0 0 16 16">
                                        <path
                                            d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21.294 21.294 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.29 9.86 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21.317 21.317 0 0 0 14 7.655V1.222z" />
                                    </svg>
                                    <span class="tultip-content" style="width: 142px; margin-left: -71px;">Report
                                        Phrase</span>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Sentence overlay section -->
        <div id="search-sentence-section" style="display: none;">
            <div class="form-group">
                <div class="input-group mb-3">
                    <input id="search-sentence-input" class="form-control custom-input" type="search"
                        placeholder="Search Sentence" autocomplete="off">
                    <div class="input-group-text">
                        <small>"Enter" to Search</small>
                    </div>
                    <button id="search-sentence-btn" class="input-group-append btn btn-outline-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                            class="bi bi-search" viewBox="0 0 16 16">
                            <path
                                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                        </svg>
                    </button>
                </div>
            </div>
            <div id="sentence-search-alert"></div>
            <div class="table-responsive" id="sentence-results" style="display: none;">
                <table class="table ">
                    <thead>
                        <tr>
                            <th>Sentence</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="sentence-results-tbody">

                    </tbody>
                </table>
            </div>
        </div>
        <br>
        <div style="display: grid;">
            <button class="close-search-overlay-btn btn btn-secondary">Close</button>
        </div>
    </div>
</div>

<!-- Existing Trans or Create Tran Overlay -->
<div id="uorc-overlay">
    <div id="uorc-overlay-content">
        <div style="display: flex; justify-content: space-between; margin-bottom: 2%;">
            <div style="width: -webkit-fill-available; float:left;">
                <h5><strong id="uorc-title"></strong></h5>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" style="cursor:pointer;"
                class="uorc-cancel-btn bi bi-x-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path
                    d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
            </svg>
        </div>
        <div style="font-size: 14px; color: #4f5660;">
            Add existing translation or Create a new one
            <span id="uorc-message"></span>
        </div>
        <div style="border-top: thin solid; margin: 3% 0 4% 0;"></div>
        <div class="form-row">
            <button id="existing-wtran-btn" class="col btn btn-secondary" type="button">
                Existing Translations
            </button>
            <div style="width: 100%; text-align: center; font-size: 11px; margin: 1% 0 1% 0;">
                OR
            </div>
            <button id="create-newtran-btn" class="col btn btn-secondary" type="button">
                Create Translation
            </button>
        </div>
    </div>
</div>

<!-- Existing Trans Overlay -->
<div id="ewts-overlay">
    <div id="ewts-overlay-content">
        <div style="display: flex; justify-content: space-between; margin-bottom: 2%;">
            <div style="width: -webkit-fill-available; text-align: center;">
                <div id="ewts-title">Existing {{course_learning.language_speaking}} Translations</div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" style="cursor:pointer;"
                class="ewts-cancel-btn bi bi-x-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path
                    d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
            </svg>
        </div>
        <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
        <input id="swtran-input" class="form-control me-2 custom-input" type="search" placeholder="Search translation"
            aria-label="Search" autocomplete="off">
        <div class="table-responsive">
            <table id="ewtrans-table" class="table table-hover">
                <thead>
                    <tr class="table-header">
                        <th style="width: 15%; cursor: pointer;"></th>
                        <th style="width: 50%;">
                            <span>{{course_learning.language_speaking}} Translation</span>
                        </th>
                        <th style="width: 15%;" class="sort-number">
                            <span>User Using</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-people" viewBox="0 0 16 16">
                                <path
                                    d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816zM4.92 10A5.493 5.493 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275zM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4z" />
                            </svg>
                        </th>
                        <th style="width: 12%;"></th>
                        <th style="width: 8%;"></th>
                    </tr>
                </thead>
                <tbody id="ewtrans-tbody"></tbody>
            </table>
            <div id="ewtrans-announce"></div>
        </div>
        <div class="form-row">
            <button class="ewts-cancel-btn col btn" style="color: whitesmoke;"><u>Cancel</u></button>
            <!-- <button id="word-create-tran-btn" class="col btn btn-secondary">Create Translation</button> -->
        </div>
    </div>
</div>

<!-- Create/Update Word Tran Overlay -->
<div id="wt-overlay">
    <div id="wt-overlay-content">
        <div style="display: flex; justify-content: space-between;">
            <div style="width: -webkit-fill-available; text-align: center;">
                <div id="wt-title"></div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" style="cursor:pointer;"
                class="wt-cancel-btn bi bi-x-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path
                    d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
            </svg>
        </div>
        <br>
        <form autocomplete="off" id="wt-form">
            {% csrf_token %}
            <div id="wt-word" data-word="" hidden></div>
            <div id="wt-confirm"></div>
            <div class="form-row">
                <div id="wt-pos" class="col-md-6">
                    <label id="wt-pos-label" for="wt-pos" title="Part Of Speech" class="text-danger">* POS:</label>
                    <select id="wt-poselect" class="form-control custom-select" required>
                        <option value="" selected disabled hidden>Select a part of speech</option>
                        {% for p in pos %}
                        <option value="{{p}}">{{p}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <div id="wt-ipa"></div>
                </div>
            </div>
            <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
            <div id="wt-meanings"></div>
            <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>

            <div id="wt-def"></div>
            <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
            <div id="wt-node"></div>
            <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
            <br>
            <div class="form-row" id="wt-footer"></div>
        </form>
    </div>
</div>

<!-- Confirm Overlay -->
<div id="cf-overlay">
    <div id="cf-overlay-content">
        <div style="display: flow-root; color: whitesmoke;">
            <div id="cf-title" style="float:left; margin-bottom: 2%;"></div>
            <div id="cf-message" style="float:left; font-size: 14px; color: #4f5660;"></div>
        </div>
        <div style="border-top: thin solid; margin: 3% 0 3% 0;"></div>
        <div class="form-row" id="cf-footer"></div>
    </div>
</div>

<!-- Report Overlay -->
<div id="rp-overlay">
    <div id="rp-overlay-content">
        <div style="display: grid; color: whitesmoke;">
            <div style="text-align:center; margin-bottom: 1%;">
                <h5><strong id="rp-title"></strong></h5>
            </div>
            <div style="float:left;font-size: 14px; color: #4f5660;">
                <span>Is there something wrong with this <span id="rp-message"></span>?
                    Would you like to send a ticket:</span>
                <div style="margin-left: 12px;">
                    <div><strong>&#9730; Describe the issue</strong></div>
                    <div><strong>&#9730; Picture</strong> to proof</div>
                    <div><strong>&#9730; Your learning course</strong></div>
                </div>
                to channel <strong id="rp-channel"></strong> on our Discord.
            </div>
            <div style="border-top: thin solid; margin: 3% 0 3% 0;"></div>
            <div id="rp-footer" class="form-row"></div>
        </div>
    </div>
</div>
</div>

<!-- Scroll up button -->
<button id="scroll-up-btn" class="btn btn-outline-secondary" class="dropdown" data-toggle="tooltip" data-placement="top"
    title="Scroll up" style="position: fixed; bottom: 32px; right: 22px; display: none; ">
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-chevron-compact-up"
        viewBox="0 0 16 16">
        <path fill-rule="evenodd"
            d="M7.776 5.553a.5.5 0 0 1 .448 0l6 3a.5.5 0 1 1-.448.894L8 6.56 2.224 9.447a.5.5 0 1 1-.448-.894l6-3z">
        </path>
    </svg>
</button>


<!-- Alert things -->
<div id="alert-things" style="position: fixed; bottom: 82px; right: 20px; z-index: 2;"></div>

<!-- Settings lesson -->
{% if request.user == lesson.user %}
<div class="dropdown" data-toggle="tooltip" data-placement="top" title="Setting"
    style="position: absolute; top: 136px; right: 20px; z-index: 1;">
    <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-gear"
            viewBox="0 0 16 16">
            <path
                d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z" />
            <path
                d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z" />
        </svg>
    </button>
    <div class="dropdown-menu" style="background: linear-gradient(to top, #232526, #414345);">
        <!-- <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div> -->
        <div class="text-danger" style="cursor: pointer; text-align: center;">
            Delete Lesson
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash"
                viewBox="0 0 16 16">
                <path
                    d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                <path fill-rule="evenodd"
                    d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
            </svg>
        </div>
    </div>
</div>
{% endif %}
<!-- Setting lesson -->

<div style="background-color: #36393f;">
    <!-- Header Section -->
    <section>
        <div style="text-align: center;">
            <br>
            <h3>Lesson: <strong>{{lesson.name}}</strong></h3>
            <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
            <div>
                {% for topic in lesson.topic.all %}
                <span class="badge badge-pill badge-light">{{topic}}</span>
                {% endfor %}
            </div>
        </div>
        <div style="margin: 10px 20px 0 20px;">
            <div class="form-row">
                <div class="col">
                    <strong>Created</strong>: {{lesson.date_created|date:"D d M Y"}}
                </div>
                <div class="col">
                    <strong>Latest update</strong>: {{lesson.date_updated|date:"D d M Y"}}
                </div>
            </div>
            <div>
                <strong>Creator</strong>: <a href="{% url 'profile' lesson.user %}"
                    class="link-light">{{lesson.user}}</a>
            </div>
            <br>
        </div>
        <!-- Start Lesson button -->
        <div style="text-align: center;">
            <a class="link-success" href="{% url 'lesson-learn' lesson.id %}">Start Lesson</a>
        </div>
        <br>
        <div style="text-align: center;">
            <button id="show-words-btn" class="btn btn-secondary">
                Words
                <span class="badge badge-pill badge-light">{{lesson.word.count}}</span>
            </button>
            <button id="show-phrases-btn" class="btn btn-outline-secondary">
                Phrases
                <span class="badge badge-pill badge-light">{{lesson.phrase.count}}</span>
            </button>
            <button id="show-sentences-btn" class="btn btn-outline-secondary">
                Sentences
                <span class="badge badge-pill badge-light">{{lesson.sentence.count}}</span>
            </button>
        </div>
    </section>

    <!-- Word Section -->
    <section id="word-section" style="display: block;">
        <div style=" margin: 0 20px 0 20px;">
            {% if request.user == lesson.user %}
            <div style="display: grid;">
                <button style="margin-top: 1%;" class="btn btn-secondary" id="add-word-btn">Add word</button>
            </div>
            {% endif %}
            <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
            <input id="word-inl-input" class="form-control me-2 custom-input" type="search" placeholder="Search word"
                aria-label="Search" autocomplete="off">
            <div class="table-responsive">
                <table class="table table-hover" id="words-table">
                    <thead>
                        <tr>
                            <th style="width: 24%; cursor: pointer;" id="sort-word">
                                <span>Word</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-arrow-down-up" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5zm-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5z" />
                                </svg>
                            </th>
                            <th style="width: 60%; cursor: pointer;">
                                <span>{{course_learning.language_speaking}} Translation</span>
                            </th>
                            <th style="width: 16%;"></th>
                        </tr>
                    </thead>
                    <tbody id="words-tbody">
                        {% for word in words_in_lesson_list %}
                        {% if not word.is_missing_tran %}
                        <tr data-word="{{word.word}}" data-word-tr-id="{{word.word_id}}"
                            data-wtran-tr-id="{{word.detail.word_tran_id}}">
                            <td>
                                <span style="font-size: 22px;">{{word.word}}</span><br>
                                <small><i data-toggle="tooltip" data-placement="top"
                                        title="Part Of Speech">{{word.detail.pos}}</i></small><br>
                                <small>
                                    <span class="speaker" data-text="{{word.word}}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"
                                            fill="currentColor" class="bi bi-volume-up" viewBox="0 0 16 16"
                                            style="cursor: pointer;">
                                            <path
                                                d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z" />
                                            <path
                                                d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z" />
                                            <path
                                                d="M10.025 8a4.486 4.486 0 0 1-1.318 3.182L8 10.475A3.489 3.489 0 0 0 9.025 8c0-.966-.392-1.841-1.025-2.475l.707-.707A4.486 4.486 0 0 1 10.025 8zM7 4a.5.5 0 0 0-.812-.39L3.825 5.5H1.5A.5.5 0 0 0 1 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 7 12V4zM4.312 6.39 6 5.04v5.92L4.312 9.61A.5.5 0 0 0 4 9.5H2v-3h2a.5.5 0 0 0 .312-.11z" />
                                        </svg>
                                    </span>
                                    <i data-toggle="tooltip" data-placement="top"
                                        title="International Phonetic Alphabet">{{word.detail.ipa}}</i>
                                </small>
                            </td>
                            <td>
                                <div>
                                    Meaning:
                                    {% for wmeaning in word.detail.meaning %}
                                    {% if wmeaning %}
                                    <pre>    {{ wmeaning }}</pre>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                                <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
                                <div>Definition: {{word.detail.def}}</div>
                                <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
                                <div>Node: {{word.detail.node}}</div>
                                <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
                                <div>Creator:
                                    <a style="cursor: pointer;" class="link-light"
                                        href="/profile/{{word.detail.creator}}">{{word.detail.creator}}</a>
                                </div>
                            </td>
                            <td>
                                <div style="display: none;" class="sei">
                                    {% if request.user == lesson.user %}
                                    <div data-toggle="tooltip" data-placement="top" title="Add Another Translation"
                                        class="add-wtran ei" data-word="{{word.word}}" data-word-id="{{word.word_id}}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                                            <path
                                                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                            <path
                                                d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                                        </svg>
                                    </div>
                                    {% if word.detail.is_creator %}
                                    <div data-toggle="tooltip" data-placement="top" title="Edit Translation"
                                        class="edit-wtran ei" data-word="{{word.word}}" data-word-id="{{word.word_id}}"
                                        data-wtran-id="{{word.detail.word_tran_id}}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                                            <path
                                                d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z" />
                                        </svg>
                                    </div>
                                    <div data-toggle="tooltip" data-placement="top" title="Delete Translation"
                                        class="delete-wtran ei" data-word="{{word.word}}"
                                        data-word-id="{{word.word_id}}" data-wtran-id="{{word.detail.word_tran_id}}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            fill="currentColor" class="bi bi-trash text-danger" viewBox="0 0 16 16">
                                            <path
                                                d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                                            <path fill-rule="evenodd"
                                                d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
                                        </svg>
                                    </div>
                                    {% else %}
                                    <div data-toggle="tooltip" data-placement="top" title="Remove Translation"
                                        class="ei remove-wtran" data-word="{{word.word}}"
                                        data-word-id="{{word.word_id}}" data-wtran-id="{{word.detail.word_tran_id}}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            fill="currentColor" class="bi bi-x-circle text-danger" viewBox="0 0 16 16">
                                            <path
                                                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                            <path
                                                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                                        </svg>
                                    </div>
                                    {% endif %}
                                    <div data-toggle="tooltip" data-placement="top" title="Remove Word"
                                        class="remove-word ei" data-word="{{word.word}}"
                                        data-word-id="{{word.word_id}}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            fill="currentColor" class="bi bi-x-lg text-danger" viewBox="0 0 16 16">
                                            <path
                                                d="M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z" />
                                        </svg>
                                    </div>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr data-word="{{word.word}}" data-word-tr-id="{{word.word_id}}" data-wtis-missing="true">
                            <td>
                                <span style="font-size: 22px;">{{word.word}}</span><br>
                                <small><i title="Part Of Speech" class="text-danger">-</i></small><br>
                                <small>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                                        class="bi bi-volume-up" viewBox="0 0 16 16" style="cursor: pointer;">
                                        <path
                                            d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z" />
                                        <path
                                            d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z" />
                                        <path
                                            d="M10.025 8a4.486 4.486 0 0 1-1.318 3.182L8 10.475A3.489 3.489 0 0 0 9.025 8c0-.966-.392-1.841-1.025-2.475l.707-.707A4.486 4.486 0 0 1 10.025 8zM7 4a.5.5 0 0 0-.812-.39L3.825 5.5H1.5A.5.5 0 0 0 1 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 7 12V4zM4.312 6.39 6 5.04v5.92L4.312 9.61A.5.5 0 0 0 4 9.5H2v-3h2a.5.5 0 0 0 .312-.11z" />
                                    </svg>
                                    <i title="International Phonetic Alphabet" class="text-danger">-</i>
                                </small>
                            </td>
                            <td class="text-danger">-</td>
                            <td>
                                <div style="display: none;" class="sei">
                                    {% if request.user == lesson.user %}
                                    <div data-toggle="tooltip" data-placement="top" title="Add Translation"
                                        class="add-wtran ei" data-word="{{word.word}}" data-word-id="{{word.word_id}}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                                            <path
                                                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                            <path
                                                d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                                        </svg>
                                    </div>
                                    <div data-toggle="tooltip" data-placement="top" title="Remove Word"
                                        class="remove-word ei" data-word="{{word.word}}"
                                        data-word-id="{{word.word_id}}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            fill="currentColor" class="bi bi-x-lg text-danger" viewBox="0 0 16 16">
                                            <path
                                                d="M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z" />
                                        </svg>
                                    </div>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Phrase Section -->
    <section id="phrase-section" style="display: none;">
        <div style=" margin: 0 20px 0 20px;">
            {% if request.user == lesson.user %}
            <div style="display: grid;">
                <button style="margin-top: 1%;" class="btn btn-secondary" id="add-phrase-btn">Add phrase</button>
            </div>
            {% endif %}
        </div>
        <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
        <input id="phrase-inl-input" class="form-control me-2 custom-input" type="search"
            placeholder="Search phrase in lesson" aria-label="Search" autocomplete="off">
        <div class="table-responsive">
            <table class="table table-hover" id="phrases-table">
                <thead>
                    <tr>
                        <th>Phrase</th>
                        <th title="International Phonetic Alphabet">IPA</th>
                        <th title="Meaning in {{course_learning.language_speaking}}">Meaning</th>
                        <th>Definition</th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="phrases-tbody"></tbody>
            </table>
        </div>
    </section>

    <!-- Sentence Section -->
    <section id="sentence-section" style="display: none; margin: 20px 20px 20px 20px;">
        <input class="form-control me-2" type="search" placeholder="Search sentence in lesson" aria-label="Search"
            autocomplete="off">
        {% if request.user == lesson.user %}
        <br>
        <button class="btn btn-outline-secondary" id="add-sentence-btn">
            Add sentence
        </button>
        {% endif %}
        <br><br>
        <div class="table-responsive">
            <table class="table table-hover" id="sentences-table">
                <thead>
                    <tr>
                        <th>Sentence</th>
                        <th title="International Phonetic Alphabet">IPA</th>
                        <th title="Meaning in {{course_learning.language_speaking}}">Meaning</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="sentences-tbody"></tbody>
            </table>
        </div>
    </section>
</div>

<script>
    const requestUser = `{{ request.user }}`
    const course_id = `{{ course_learning.id }}`
    const lesson_id = `{{ lesson.id }}`
    const language_learning = `{{ course_learning.language_learning }}`
    const language_speaking = `{{ course_learning.language_speaking }}`

    const addWordURL = `{% url 'lesson-add-word' lesson.id %}`
    const addNewordUrl = `{% url 'lesson-add-neword' lesson.id %}`
    const removeWordURL = `{% url 'lesson-remove-word' lesson.id %}`

    const getWtranUrl = `{% url 'get-word-tran' %}`
    const getEwtransUrl = `{% url 'get-eword-trans' %}`
    const updateWtranUrl = `{% url 'update-word-tran' %}`

    const addWtranUrl = `{% url 'add-word-tran' lesson.id %}`
    const createWtranUrl = `{% url 'create-word-tran' lesson.id %}`
    const removeWtranUrl = `{% url 'remove-word-tran' lesson.id %}`
    const deleteWtranUrl = `{% url 'delete-word-tran' lesson.id %}`

    var seconds_left = `{{ seconds_left }}`
    var words_created = `{{ words_created }}`
    var phrases_created = `{{ phrases_created }}`
</script>
<!-- <script src="{% static 'js/lesson/lesson_detail.js'%}"></script> -->

<!-- Sections's Event -->
<script>

    var scrollUpBtn = document.getElementById("scroll-up-btn")
    window.onscroll = () => {
        if (document.body.scrollTop > 220 || document.documentElement.scrollTop > 220) {
            scrollUpBtn.style.display = "block";
        } else {
            scrollUpBtn.style.display = "none";
        }
    };

    // window.addEventListener('DOMContentLoaded', (event) => {
    //     sortWord(0)
    // });

    scrollUpBtn.addEventListener("click", () => {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    })

    var showWordsBtn = document.getElementById("show-words-btn")
    var showPhrasesBtn = document.getElementById("show-phrases-btn")
    var showSentencesBtn = document.getElementById("show-sentences-btn")

    var wordSection = document.getElementById("word-section")
    var phraseSection = document.getElementById("phrase-section")
    var sentenceSection = document.getElementById("sentence-section")

    showWordsBtn.addEventListener('click', () => {
        if (wordSection.style.display == 'none') {
            showWordsBtn.classList.replace("btn-outline-secondary", "btn-secondary")
            showPhrasesBtn.classList.replace("btn-secondary", "btn-outline-secondary")
            showSentencesBtn.classList.replace("btn-secondary", "btn-outline-secondary")

            wordSection.style.display = "block";
            phraseSection.style.display = "none";
            sentenceSection.style.display = "none";
        }
    })

    showPhrasesBtn.addEventListener('click', () => {
        if (phraseSection.style.display == 'none') {
            showPhrasesBtn.classList.replace("btn-outline-secondary", "btn-secondary")
            showWordsBtn.classList.replace("btn-secondary", "btn-outline-secondary")
            showSentencesBtn.classList.replace("btn-secondary", "btn-outline-secondary")

            phraseSection.style.display = "block";
            wordSection.style.display = "none";
            sentenceSection.style.display = "none";
        }
    })

    showSentencesBtn.addEventListener('click', () => {
        if (sentenceSection.style.display == 'none') {
            showSentencesBtn.classList.replace("btn-outline-secondary", "btn-secondary")
            showWordsBtn.classList.replace("btn-secondary", "btn-outline-secondary")
            showPhrasesBtn.classList.replace("btn-secondary", "btn-outline-secondary")

            sentenceSection.style.display = "block";
            wordSection.style.display = "none";
            phraseSection.style.display = "none";
        }
    })

    window.onclick = function (event) {
        if (event.target == searchOverlay) {
            searchOverlay.style.display = "none";
        }
        else if (event.target == wtOverlay) {
            wtOverlay.style.display = "none";
        }
        else if (event.target == ewtsOverlay) {
            ewtsOverlay.style.display = "none";
        }
        else if (event.target == uorcOverlay) {
            uorcOverlay.style.display = "none";
        }
        else if (event.target == cfOverlay) {
            cfOverlay.style.display = "none";
        }
        else if (event.target == rpOverlay) {
            rpOverlay.style.display = "none";
        }
    }



    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })



    // $(document).ready(function () {
    //     $('[data-toggle="popover"]').popover();
    // });

    // Select a specified element
    //$('#myPopover').popover();



</script>

<!-- Search/Sort/Speak stuffs in lesson -->
<script>
    function speakS(text) {
        speechSynthesis.cancel()
        var voice = new SpeechSynthesisUtterance(text)
        window.speechSynthesis.speak(voice)
    }

    document.querySelectorAll(".speaker").forEach(speaker => speaker.addEventListener("click", () => {
        speakS(speaker.dataset.text)
    }));

    document.querySelector("#sort-word").addEventListener("click", () => {
        sortWord(0)
    });

    var wordIinlInput = document.getElementById("word-inl-input")
    wordIinlInput.addEventListener("input", () => {
        searchHandler(wordsTable, wordIinlInput.value.trim().toUpperCase(), true, false)
    })

    document.getElementById("swtran-input").addEventListener("input", () => {
        searchWtran()
    })

    function searchHandler(table, filter, for_word, for_phrase) {
        rows = table.getElementsByTagName("tr");
        var datasetValue
        for (i = 1; i < rows.length; i++) {
            if (for_word == true) {
                datasetValue = rows[i].dataset.word.toUpperCase()
            }
            else if (for_phrase == true) {
                datasetValue = rows[i].dataset.phrase.toUpperCase()
            }

            if (datasetValue.indexOf(filter) > -1) {
                rows[i].style.display = "";
            } else {
                rows[i].style.display = "none";
            }
        }

        // var tr = table.getElementsByTagName("tr");
        // for (var i = 0; i < tr.length; i++) {
        //     if (tr.textContent.toUpperCase().indexOf(filter) > -1) {
        //         tr[i].style.display = "";
        //     } else {
        //         tr[i].style.display = "none";
        //     }
        // }

        // var tds = tr.getElementsByTagName('td');
        // for (var i = 0; i < tr.length; i++) {
        //     var firstCol = tds[0].textContent.toUpperCase();
        //     var secondCol = tds[1].textContent.toUpperCase();
        //     if (firstCol.indexOf(filter) > -1 || secondCol.indexOf(filter) > -1) {
        //         tr[i].style.display = "";
        //     } else {
        //         tr[i].style.display = "none";
        //     }
        // }
        // -------------------------------------


        // for (i = 0; i < tr.length; i++) {
        // td_city = tr[i].getElementsByTagName("td")[2];
        // td_age = tr[i].getElementsByTagName("td")[1];
        // td_name = tr[i].getElementsByTagName("td")[0];
        // if (td_city && td_age && td_name) {
        //     txtValue_city = td_city.textContent || td_city.innerText;
        //     txtValue_age = td_age.textContent || td_age.innerText;
        //     txtValue_name = td_name.textContent || td_name.innerText;
        //     if (txtValue_city.toUpperCase().indexOf(filter_city) > -1
        //         && txtValue_age.toUpperCase().indexOf(filter_age) > -1
        //         && txtValue_name.toUpperCase().indexOf(filter_name) > -1) {
        //         tr[i].style.display = "";
        //     }
        //     else {
        //         tr[i].style.display = "none";
        //     }
        // }
    }

    function searchWtran() {
        var wtranQ = document.getElementById("swtran-input").value.trim().toUpperCase();
        var rows = document.querySelector("#ewtrans-table tbody").rows;
        for (var i = 0; i < rows.length; i++) {
            var firstCol = rows[i].cells[0].textContent.toUpperCase();
            var secondCol = rows[i].cells[1].textContent.toUpperCase();
            var thirdCol = rows[i].cells[2].textContent.toUpperCase();
            if (firstCol.indexOf(wtranQ) > -1 || secondCol.indexOf(wtranQ) > -1 || thirdCol.indexOf(wtranQ) > -1) {
                rows[i].style.display = "";
            } else {
                rows[i].style.display = "none";
            }
        }

        // // Get all rows, except the header and convert to array so .forEach() can be used to loop 
        // var rows = Array.prototype.slice.call(ewtransTable.querySelectorAll("tr:not(.table-header)"));
        // rows.forEach(function (row) {
        //     // You really don't need to know if the search criteria is in the first or second cell. You only need to know if it is in the row.
        //     var data = "";
        //     // Loop over all the cells in the current row and concatenate their text
        //     Array.prototype.slice.call(row.getElementsByTagName("td")).forEach(function (r) {
        //         // Don't use .innerHTML unless there is HTML. Use textContent when there isn't.
        //         data += r.textContent
        //     });

        //     // Check the string for a match and show/hide row as needed. Don't set individual styles. Add/remove classes instead
        //     if (data.toUpperCase().indexOf(wtranQ) > -1) {
        //         row.style.display = "";
        //     } else {
        //         row.style.display = "none";
        //     }
        // });
    }

    function sortWord(n) {
        var rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        switching = true;
        //Set the sorting direction to ascending:
        dir = "desc";
        /*Make a loop that will continue until no switching has been done:*/
        while (switching) {
            //start by saying: no switching is done:
            switching = false;
            rows = wordsTable.rows;
            /*Loop through all table rows (except the first, which contains table headers):*/
            for (i = 1; i < (rows.length - 1); i++) {
                //start by saying there should be no switching:
                shouldSwitch = false;
                /*Get the two elements you want to compare, one from current row and one from the next:*/
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];
                /*check if the two rows should switch place, based on the direction, asc or desc:*/
                if (dir == "desc") {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir == "asc") {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
                /*If a switch has been marked, make the switch and mark that a switch has been done:*/
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                //Each time a switch is done, increase this count by 1:
                switchcount++;
            } else {
                /*If no switching has been done AND the direction is "asc", set the direction to "desc" and run the while loop again.*/
                if (switchcount == 0 && dir == "desc") {
                    dir = "asc";
                    switching = true;
                }
            }
        }
    }



</script>

<!-- Create/Update Word Tran's Events -->
<script>
    var alertThings = document.getElementById("alert-things")

    var wtOverlay = document.getElementById("wt-overlay")
    var wtOverlayContent = document.getElementById("wt-overlay-content")

    var uorcOverlay = document.getElementById("uorc-overlay")
    var uorcOverlayContent = document.getElementById("uorc-overlay-content")
    document.querySelectorAll(".uorc-cancel-btn").forEach(uorcCancelBtn => uorcCancelBtn.addEventListener("click", () => {
        uorcOverlay.style.display = "none";
    }));

    var ewtsOverlay = document.getElementById("ewts-overlay")
    var ewtsOverlayContent = document.getElementById("ewts-overlay-content")
    document.querySelectorAll(".ewts-cancel-btn").forEach(ewtsCancelBtn => ewtsCancelBtn.addEventListener("click", () => {
        ewtsOverlay.style.display = "none";
    }));


    function wtranHandler(word, word_id, word_tran_id, is_neword, is_create, is_edit, is_edit_in_ewtran) {
        document.getElementById("wt-title").innerHTML = `
            <h2><strong>${language_speaking} Translation</strong></h2>
            <div style="font-size: 14px; color: #4f5660;"> of <strong>${word}</strong></div>`

        var wtWord = document.getElementById("wt-word")
        wtWord.innerText = `Word: ${word}`
        wtWord.dataset.word = word

        if (is_neword == true) {
            // Confirm's events
            document.getElementById("wt-confirm").innerHTML = `
            <input class="custom-input" type="checkbox" id="wt-confirm-cbx" value="wt-confirm-word">
            <label id="wt-confirm-label" for="wt-confirm-cbx" class="text-danger">
                * Confirm <strong><i>${word}</i></strong> is ${language_learning} word
            </label>
            <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>`

            var wtConfirmCbx = document.getElementById("wt-confirm-cbx")
            var wtConfirmLabel = document.getElementById("wt-confirm-label")
            wtConfirmCbx.addEventListener("change", () => {
                if (wtConfirmCbx.checked == false) {
                    wtConfirmLabel.classList.add("text-danger")
                }
                else {
                    wtConfirmLabel.classList.remove("text-danger")
                }
                checkValidwtForm()
            })
        }
        else {
            document.getElementById("wt-confirm").innerHTML = ``
        }

        // Pos's events
        var wtPoselect = document.getElementById("wt-poselect")
        var wtPosLabel = document.getElementById("wt-pos-label")
        var wtPosValid = false
        wtPosLabel.classList.add("text-danger")
        wtPoselect.selectedIndex = 0
        wtPoselect.addEventListener("change", () => {
            wtPosValid = true
            wtPosLabel.classList.remove("text-danger")
            checkValidwtForm()
        })

        // Ipa's events
        document.getElementById("wt-ipa").innerHTML = `
        <label id="wt-ipa-label" for="dwt-ipa-input" title="International Phonetic Alphabet" class="text-danger">*
            IPA:</label>
        <input id="wt-ipa-input" type="text" class="form-control custom-input" required>
        <small id="wt-ipa-alert"></small>`
        var wtIpaLabel = document.getElementById("wt-ipa-label")
        var wtIpaInput = document.getElementById("wt-ipa-input")
        var wtIpaAlert = document.getElementById("wt-ipa-alert")
        var wtIpaValid = false

        wtIpaInput.addEventListener("input", () => {
            if (wtIpaInput.value.trim().length == 0) {
                wtIpaValid = false
                wtIpaLabel.classList.add("text-danger")
                wtIpaAlert.innerHTML = `
                <div class="text-danger">Please enter an <strong>ipa</strong></div>`
                setTimeout(() => { wtIpaAlert.innerHTML = `` }, 6000);
            } else {
                wtIpaAlert.innerHTML = ``
                wtIpaValid = true
                wtIpaLabel.classList.remove("text-danger")
            }
            checkValidwtForm()
        })

        // Meaning's events
        document.getElementById("wt-meanings").innerHTML = ` 
        <div style="margin-bottom: 1%;">      
            <label id="wt-meanings-label" for="wt-add-meaning-btn" class="text-danger">* Meaning:</label>
            <button id="wt-add-meaning-btn" class="btn btn-secondary">
                Add meaning
            </button>
        </div>
        <div id="wt-meanings-watcher"></div>
        <small id="wt-meanings-alert"></small>`

        var wtMeaningsLabel = document.getElementById("wt-meanings-label")
        var wtMeaningsAlert = document.getElementById("wt-meanings-alert")
        var wtMeaningsValid = false
        var wtMeaningsWatcher = document.getElementById("wt-meanings-watcher")
        if (is_neword == true || is_create == true) {
            wtMeaningsWatcher.innerHTML = `
            <div class="input-group mb-3">
                <input type="text" class="form-control wt-meaning custom-input"
                    placeholder="Meaning in ${language_speaking}" required>
                <button class="wt-rmeaning input-group-append btn btn-outline-secondary" type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                        class="bi bi-trash text-danger" viewBox="0 0 16 16">
                        <path
                            d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                        <path fill-rule="evenodd"
                            d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
                    </svg>
                </button>
            </div>`

            document.querySelectorAll(".wt-meaning").forEach(wtMeaning => wtMeaning.addEventListener('input', () => {
                wtMeaningEvent(wtMeaning)
            }));

            document.querySelectorAll(".wt-rmeaning").forEach(wtRmeaning => wtRmeaning.addEventListener('click', () => {
                wtRmeaningEvent(wtRmeaning)
            }));
        }

        document.getElementById("wt-add-meaning-btn").addEventListener('click', event => {
            event.preventDefault();
            //event.stopPropagation()
            wtAddMeaningEvent(null)
        })

        function wtMeaningEvent(element) {
            if (element.value.trim().length == 0) {
                wtMeaningsAlert.innerHTML = `
                    <div class="text-danger">Please enter a <strong>meaning</strong></div>`
                setTimeout(() => { wtMeaningsAlert.innerHTML = `` }, 6000);
            } else
                wtMeaningsAlert.innerHTML = ``
            checkValidwtForm()
        }

        function wtRmeaningEvent(element) {
            event.preventDefault()
            if (wtMeaningsWatcher.childElementCount > 1) {
                element.parentElement.remove();
                wtMeaningsAlert.innerHTML = ``
            }
            else {
                wtMeaningsAlert.innerHTML = `
                <div class="text-danger">Your translation need atleast a <strong>meaning</strong></div>`
                setTimeout(() => { wtMeaningsAlert.innerHTML = `` }, 6000);
            }
            checkValidwtForm()
        }

        function wtAddMeaningEvent(meaning) {
            wtOverlayContent.style.height = 'auto';
            var divWrapper = document.createElement("div");
            divWrapper.classList.add("input-group", "mb-3")

            var inputMeaning = document.createElement("input");
            inputMeaning.classList.add("form-control", "wt-meaning", "custom-input")
            inputMeaning.type = "text"
            inputMeaning.placeholder = `Meaning in ${language_speaking}`
            if (meaning != null) {
                inputMeaning.value = meaning
            }

            var buttonRmeaning = document.createElement("button");
            buttonRmeaning.classList.add("wt-rmeaning", "input-group-append", "btn", "btn-outline-secondary")
            buttonRmeaning.type = "button"
            buttonRmeaning.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                class="bi bi-trash text-danger" viewBox="0 0 16 16">
                <path
                    d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                <path fill-rule="evenodd"
                    d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
            </svg>`

            divWrapper.append(inputMeaning, buttonRmeaning)
            wtMeaningsWatcher.appendChild(divWrapper)
            inputMeaning.focus()

            inputMeaning.addEventListener('input', () => { wtMeaningEvent(inputMeaning) });
            buttonRmeaning.addEventListener('click', () => { wtRmeaningEvent(buttonRmeaning) });
            checkValidwtForm()
        }

        // Definition's events
        document.getElementById("wt-def").innerHTML = `
        <label for="wt-def-input">Definition:</label>
        <input id="wt-def-input" type="text" class="form-control custom-input">`

        var wtDefInput = document.getElementById("wt-def-input")
        if (is_edit == true) {
            wtDefInput.addEventListener("input", () => {
                checkValidwtForm()
            })
        }

        // Node's events
        document.getElementById("wt-node").innerHTML = `
        <label for="wt-node-input">Node:</label>
        <input id="wt-node-input" type="text" class="form-control custom-input">`

        var wtNodeInput = document.getElementById("wt-node-input")
        if (is_edit == true) {
            wtNodeInput.addEventListener("input", () => {
                checkValidwtForm()
            })
        }

        // Footer's events
        var wtOldDetail;
        if (is_neword == true || is_create == true) {
            document.getElementById("wt-footer").innerHTML = `
            <div class="col wt-cancel-btn btn" style="color: whitesmoke;"><u>Cancel</u></div>
            <button id="wt-create-btn" class="col btn btn-secondary" type="submit" disabled>
                Create Translation
            </button>`

            var wtCreateBtn = document.getElementById("wt-create-btn")
            wtCreateBtn.addEventListener('click', event => {
                event.preventDefault()
                addNewordFetch()
            })

        } else if (is_edit == true) {
            document.getElementById("wt-footer").innerHTML = `
            <div class="col wt-cancel-btn btn" style="color: whitesmoke;"><u>Cancel</u></div>
            <button id="wt-update-btn" class="col btn btn-secondary" type="submit" disabled>
                Update Translation
            </button>`
            var wtUpdateBtn = document.getElementById("wt-update-btn")
            getWtranFetch()
        }

        document.querySelectorAll(".wt-cancel-btn").forEach(wtCancelBtn => wtCancelBtn.addEventListener("click", () => {
            wtOverlay.style.display = "none";
        }));

        wtOverlay.style.display = "block"

        function getWtranFetch() {
            fetch(getWtranUrl + `?wordtranid=${word_tran_id}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
            }).then(response => response.json())
                .then(response => {
                    const gwt_success = response.is_success
                    if (gwt_success == true) {
                        wtOldDetail = response.detail
                        document.getElementById("wt-title").innerHTML = `
                            <h2><strong>${language_speaking} Translation</strong></h2>
                            <div style="font-size: 14px; color: #4f5660;"> of <strong>${response.word}</strong></div>`
                        wtWord.innerText = `Word: ${response.word}`
                        wtWord.dataset.word = response.word
                        wtPoselect.value = wtOldDetail.pos
                        wtIpaInput.value = wtOldDetail.ipa
                        wtDefInput.value = wtOldDetail.def
                        wtNodeInput.value = wtOldDetail.node
                        wtOldDetail.meaning.forEach(meaning => {
                            if (meaning) {
                                wtAddMeaningEvent(meaning)
                            }
                        })

                        wtPosValid = true
                        wtPosLabel.classList.remove("text-danger")

                        // wtUpdateBtn.setAttribute("data-word-id", response.word_id)
                        // wtUpdateBtn.setAttribute("data-wtran-id", wtOldDetail.word_tran_id)
                        wtUpdateBtn.addEventListener('click', event => {
                            event.preventDefault()
                            updateWtranFetch(response.word_id, wtOldDetail.word_tran_id)
                        })
                    }
                    else {
                        alert(`Oops! Something went wrong.`)
                    }
                })
                .catch((error) => {
                    console.log(error);
                });
        }

        function addNewordFetch() {
            var wtMeanings = ''
            var wrdMeaningInputs = document.querySelectorAll('.wt-meaning');
            wrdMeaningInputs.forEach(wrdMeaningInput => {
                wtMeanings += wrdMeaningInput.value.trim() + '||'
            })
            wtMeanings = wtMeanings.substring(0, wtMeanings.lastIndexOf("||"));

            var wrdDef = ''
            if (wtDefInput.value.trim().length > 0)
                wrdDef = wtDefInput.value.trim()

            var wrdNode = ''
            if (wtNodeInput.value.trim().length > 0)
                wrdNode = wtNodeInput.value.trim()

            if (is_neword == true) {
                fetch(addNewordUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken,
                    },
                    body: JSON.stringify({
                        'neword': wtWord.dataset.word,
                        'pos': wtPoselect.value,
                        'ipa': wtIpaInput.value.trim(),
                        'meaning': wtMeanings,
                        'definition': wrdDef,
                        'node': wrdNode,
                    }),

                }).then(response => response.json())
                    .then(response => {
                        const anw_success = response.is_success
                        if (anw_success == true) {
                            wtOverlay.style.display = "none"
                            searchOverlay.style.display = "none"
                            WordsTBodyHandler(response, null, false);
                            SearchWordTBodyHandler(response.word, response.word_id, null, true);
                            if (waddTimes.textContent > 0) {
                                waddTimes.innerText = waddTimes.textContent - 1
                            }
                            if (waddTimes.textContent == 0) {
                                createNewordtranBtn.disabled = true
                            }

                            alertThings.innerHTML = `
                                <div class="alert alert-success alert-dismissible fade show" role="alert">
                                    Added new word <strong>${response.word}</strong>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>`
                            setTimeout(() => { alertThings.innerHTML = `` }, 6000);
                        } else {
                            alertThings.innerHTML = `
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    ${response.message}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>`
                            setTimeout(() => { alertThings.innerHTML = `` }, 6000);
                        }
                    })
                    .catch((error) => {
                        alert(`Oops! Something went wrong.`)
                        console.log(error);
                    });
            } else if (is_create == true) {
                fetch(createWtranUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken,
                    },
                    body: JSON.stringify({
                        'word_id': word_id,
                        'pos': wtPoselect.value,
                        'ipa': wtIpaInput.value.trim(),
                        'meaning': wtMeanings,
                        'definition': wrdDef,
                        'node': wrdNode,
                    }),

                }).then(response => response.json())
                    .then(response => {
                        const awt_success = response.is_success
                        if (awt_success == true) {
                            wtOverlay.style.display = "none"
                            uorcOverlay.style.display = "none"
                            const firstWordMissingTranTr = document.querySelector(`[data-word = "${word}"][data-wtis-missing = "true"]`);
                            if (firstWordMissingTranTr) {
                                WordsTBodyHandler(response, wordsTable.rows[firstWordMissingTranTr.rowIndex], false)
                                firstWordMissingTranTr.removeAttribute("data-wtis-missing")
                                firstWordMissingTranTr.setAttribute("data-wtran-tr-id", response.detail.word_tran_id)
                            } else {
                                WordsTBodyHandler(response, null, false)
                            }

                            alertThings.innerHTML = `
                            <div class="alert alert-success alert-dismissible fade show" role="alert">
                                Added new translation for <strong>${word}</strong>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>`
                            setTimeout(() => { alertThings.innerHTML = `` }, 6000);
                        } else {
                            const is_pos_exist = response.is_pos_exist
                            if (is_pos_exist == true) {
                                alertThings.innerHTML = `
                                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                        You already have a translation of word <strong>${word}</strong> with part of speech is ${wtPoselect.value}.
                                        <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
                                        Find it in existing translations.
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>`
                                setTimeout(() => { alertThings.innerHTML = `` }, 12000);
                            }
                            else {
                                alert(`Oops! Something went wrong.`)
                            }
                        }
                    })
                    .catch((error) => {
                        alert(`Oops! Something went wrong.`)
                        console.log(error);
                    });
            }

        }

        function checkValidwtForm() {
            var wtMeanings = ''
            var wrdMeaningInputs = document.querySelectorAll('.wt-meaning');
            wrdMeaningInputs.forEach(wrdMeaningInput => {
                wtMeanings += wrdMeaningInput.value.trim() + '||'
            })
            wtMeanings = wtMeanings.substring(0, wtMeanings.lastIndexOf("||"));

            if (wtMeanings.trim().length == 0) {
                wtMeaningsLabel.classList.add("text-danger")
                wtMeaningsValid = false
            } else {
                wtMeaningsLabel.classList.remove("text-danger")
                wtMeaningsValid = true
            }

            wrdMeaningInputs.forEach(wrdMeaningInput => {
                if (wrdMeaningInput.value.trim().length == 0) {
                    wtMeaningsValid = false
                    wtMeaningsLabel.classList.add("text-danger")
                }
            })

            if (wtIpaInput.value.trim().length == 0) {
                wtIpaValid = false
            } else {
                wtIpaAlert.innerHTML = ``
                wtIpaValid = true
                wtIpaLabel.classList.remove("text-danger")
            }

            if (is_neword) {
                if (wtConfirmCbx.checked && wtPosValid && wtIpaValid && wtMeaningsValid) {
                    wtCreateBtn.disabled = false
                }
                else {
                    wtCreateBtn.disabled = true
                }
            }
            else if (is_create) {
                if (wtPosValid && wtIpaValid && wtMeaningsValid) {
                    wtCreateBtn.disabled = false
                }
                else {
                    wtCreateBtn.disabled = true
                }
            }
            else if (is_edit) {
                var meanings = ''
                wtOldDetail.meaning.forEach(meaning => {
                    meanings += meaning + "||"
                })
                meanings = meanings.substring(0, meanings.lastIndexOf("||"))
                if (wtPosValid && wtIpaValid && wtMeaningsValid) {
                    if (wtPoselect.value != wtOldDetail.pos || wtIpaInput.value != wtOldDetail.ipa ||
                        wtMeanings != meanings || wtDefInput.value != wtOldDetail.def || wtNodeInput.value != wtOldDetail.node) {
                        wtUpdateBtn.disabled = false
                    }
                    else {
                        wtUpdateBtn.disabled = true
                    }
                } else {
                    wtUpdateBtn.disabled = true
                }
            }
        }

        function updateWtranFetch(word_id, word_tran_id) {
            var wtMeanings = ''
            var wrdMeaningInputs = document.querySelectorAll('.wt-meaning');
            wrdMeaningInputs.forEach(wrdMeaningInput => {
                wtMeanings += wrdMeaningInput.value.trim() + '||'
            })
            wtMeanings = wtMeanings.substring(0, wtMeanings.lastIndexOf("||"));

            var wrdDef = ''
            if (wtDefInput.value.trim().length > 0)
                wrdDef = wtDefInput.value.trim()

            var wrdNode = ''
            if (wtNodeInput.value.trim().length > 0)
                wrdNode = wtNodeInput.value.trim()

            fetch(updateWtranUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify({
                    'lesson_id': lesson_id,
                    'word_id': word_id,
                    'word_tran_id': word_tran_id,
                    'pos': wtPoselect.value,
                    'ipa': wtIpaInput.value,
                    'meaning': wtMeanings,
                    'def': wrdDef,
                    'node': wrdNode,
                }),
            })
                .then(response => response.json())
                .then(response => {
                    const uwt_success = response.is_success
                    if (uwt_success == true) {
                        wtOverlay.style.display = "none"
                        const wtranTrs = document.querySelectorAll(`[data-wtran-tr-id = "${word_tran_id}"]`);
                        wtranTrs.forEach(wtranTr => {
                            WordsTBodyHandler(response, wordsTable.rows[wtranTr.rowIndex], false)
                        })
                        if (is_edit_in_ewtran == true) {
                            const ewtranTrs = document.querySelectorAll(`[data-ewtran-tr-id = "${word_tran_id}"]`);
                            ewtranTrs.forEach(ewtranTr => {
                                EwtransTBodyHandler(response, ewtransTable.rows[ewtranTr.rowIndex], false)
                            })
                        }
                        alertThings.innerHTML = `
                            <div class="alert alert-success alert-dismissible fade show" role="alert">
                                Updated translation of word <strong>${response.word}</strong>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>`
                        setTimeout(() => { alertThings.innerHTML = `` }, 6000);
                    } else {
                        const is_pos_exist = response.is_pos_exist
                        if (is_pos_exist == true) {
                            wtOverlay.style.display = "none"
                            alertThings.innerHTML = `
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                You already have a translation of word <strong>${word}</strong> with part of speech is ${wtPoselect.value}.
                                <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
                                Find it in existing translations.
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>`
                            setTimeout(() => { alertThings.innerHTML = `` }, 12000);
                        } else {
                            alert(`Oops! Something went wrong.`)
                        }
                    }
                })
                .catch((error) => { });
        }

    }

</script>

<!-- Eword Tran's Events -->
<script>
    function uorcWtran(addWtran) {
        createNewtranBtn.setAttribute("data-word", addWtran.dataset.word)
        createNewtranBtn.setAttribute("data-word-id", addWtran.dataset.wordId)

        existingWtranBtn.setAttribute("data-word", addWtran.dataset.word)
        existingWtranBtn.setAttribute("data-word-id", addWtran.dataset.wordId)
        document.getElementById("uorc-title").innerText = addWtran.dataset.bsOriginalTitle
        document.getElementById("uorc-message").innerHTML = `for <strong>${addWtran.dataset.word}</strong>`
        uorcOverlay.style.display = "block";
    }

    document.querySelectorAll('.add-wtran').forEach(addWtran => addWtran.addEventListener('click', () => {
        uorcWtran(addWtran)
    }))


    var createNewtranBtn = document.getElementById("create-newtran-btn")
    createNewtranBtn.addEventListener('click', event => {
        wtranHandler(createNewtranBtn.dataset.word, createNewtranBtn.dataset.wordId, null, false, true, false, false)
    })

    function ewtransHandler(word, word_id, wtransArray) {
        wtransArray.forEach(wtran => {
            var meaningPre = ``
            wtran.meaning.forEach(meaning => {
                if (meaning) {
                    meaningPre += `<pre>    ${meaning}</pre>`
                }
            });

            if (wtran.is_using == false) {
                lastColumn = `
                <td>
                    <div data-word="${word}" data-word-id="${word_id}"  data-wtran-id="${wtran.word_tran_id}" class="add-ewtran ei tultip">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
                        </svg>
                        <span class="tultip-content" >Add Translation</span>
                    </div>
                </td>`
            } else {
                if (wtran.is_creator == true) {
                    lastColumn = `
                    <td>
                        <div data-word="${word}" data-word-id="${word_id}" data-wtran-id="${wtran.word_tran_id}" class="edit-ewtran ei tultip">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z" />
                            </svg>
                            <span class="tultip-content">Edit Translation</span>
                        </div>
                        <div data-word="${word}" data-word-id="${word_id}" data-wtran-id="${wtran.word_tran_id}" class="delete-ewtran ei tultip">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash text-danger" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                                <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
                            </svg>
                            <span class="tultip-content" style="width: 160px; margin-left: -80px;">Delete Translation</span>
                        </div>
                    </td>`
                } else {
                    lastColumn = `
                    <td>
                        <div data-word="${word}" data-word-id="${word_id}" data-wtran-id="${wtran.word_tran_id}" class="remove-ewtran ei tultip">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-circle text-danger" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                            </svg>
                            <span class="tultip-content" style="width: 160px; margin-left: -80px;">Remove Translation</span>
                        </div>
                    </td>`
                }
            }
            ewtransTbody.innerHTML += `
                <tr data-ewtran-tr-id="${wtran.word_tran_id}">
                    <td>
                        <small><i data-toggle="tooltip" data-placement="top" title="Part Of Speech">${wtran.pos}</i></small><br>
                        <small>
                            <span class="nspeaker" data-text="${word}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"
                                    fill="currentColor" class="bi bi-volume-up" viewBox="0 0 16 16" style="cursor: pointer;">
                                    <path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z" />
                                    <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z" />
                                    <path d="M10.025 8a4.486 4.486 0 0 1-1.318 3.182L8 10.475A3.489 3.489 0 0 0 9.025 8c0-.966-.392-1.841-1.025-2.475l.707-.707A4.486 4.486 0 0 1 10.025 8zM7 4a.5.5 0 0 0-.812-.39L3.825 5.5H1.5A.5.5 0 0 0 1 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 7 12V4zM4.312 6.39 6 5.04v5.92L4.312 9.61A.5.5 0 0 0 4 9.5H2v-3h2a.5.5 0 0 0 .312-.11z" />
                                </svg>
                            </span>
                            <i data-toggle="tooltip" data-placement="top" title="International Phonetic Alphabet">${wtran.ipa}</i>
                        </small>
                    </td>
                    <td>
                        <div>
                            Meaning: 
                            ` + meaningPre + `
                        </div>
                        <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
                        <div>Definition: ${wtran.def}</div>
                        <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
                        <div>Node: ${wtran.node}</div>
                        <div style="border-top: thin solid; margin: 1% 0 1% 0;"></div>
                        <div>Creator:
                            <a style="cursor: pointer;" class="link-light"
                                href="/profile/${wtran.creator}">${wtran.creator}</a>
                        </div>
                    </td>
                    <td>
                        <div style="text-align: center;">${wtran.user_using}</div>
                    </td>
                    ` + lastColumn + `
                    <td>
                        <div class="report-ewtran ei tultip" style="display: none;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-flag" viewBox="0 0 16 16">
                                <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21.294 21.294 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.29 9.86 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21.317 21.317 0 0 0 14 7.655V1.222z"/>
                            </svg>
                            <span class="tultip-content" style="width: 142px; margin-left: -71px;">Report Translation</span>
                        </div>
                    </td>
                </tr> `
        });

        document.querySelectorAll(`[data-ewtran-tr-id]`).forEach(ewtranTr => {
            ewtranTr.addEventListener("mouseover", () => {
                ewtranTr.querySelector('.report-ewtran').style.display = "block"
            })

            ewtranTr.addEventListener("mouseleave", () => {
                ewtranTr.querySelector('.report-ewtran').style.display = "none"
            })
        })

        document.querySelectorAll(".nspeaker").forEach(nspeaker => nspeaker.addEventListener("click", () => {
            speakS(nspeaker.dataset.text)
        }));

        document.querySelectorAll(".edit-ewtran").forEach(editEwtran => editEwtran.addEventListener("click", () => {
            wtranHandler(editEwtran.dataset.word, editEwtran.dataset.wordId, editEwtran.dataset.wtranId, false, false, true, true)
        }));

        document.querySelectorAll(".delete-ewtran").forEach(deleteEwtran => deleteEwtran.addEventListener("click", () => {
            deleteWtranFetch(deleteEwtran, true)
        }));

        document.querySelectorAll(".remove-ewtran").forEach(removeEwtran => removeEwtran.addEventListener("click", () => {
            removeWtranFetch(removeEwtran, true)
        }));

        document.querySelectorAll('.add-ewtran').forEach(addEwtran => addEwtran.addEventListener('click', event => {
            addWtranFetch(addEwtran)
        }))

        document.querySelectorAll('.report-ewtran').forEach(reportEwtran => reportEwtran.addEventListener('click', event => {
            reportHandler(false, null, null)
        }))
    }

    var rpOverlay = document.getElementById("rp-overlay")
    const reportWordChannelLink = `https://discord.gg/4jdfDNWPS8`
    const reportPhraseChannelLink = `https://discord.gg/VVJqWRNx6x`
    const reportSentenceChannelLink = `https://discord.gg/HaDYDUMS5C`

    function reportHandler(is_word, is_phrase, is_sentence) {
        document.getElementById("rp-footer").innerHTML = `
            <div id="rp-cancel-btn" class="col btn" style="color: whitesmoke;"><u>Cancel</u></div>
            <button id="rp-btn" class="col btn btn-secondary" type="submit">
                Go to Channel
            </button>`
        document.getElementById("rp-cancel-btn").addEventListener('click', () => {
            rpOverlay.style.display = "none"
        })

        if (is_word != null) {
            if (is_word == true) {
                document.getElementById("rp-title").innerText = `Report Word`
                document.getElementById("rp-message").innerText = `word`
            } else {
                document.getElementById("rp-title").innerText = `Report Word Translation`
                document.getElementById("rp-message").innerText = `word translation`
            }
            document.getElementById("rp-channel").innerText = `#word-reporting`
            document.getElementById("rp-btn").addEventListener('click', () => {
                window.open(reportWordChannelLink);
            })
        }
        else if (is_phrase != null) {
            if (is_phrase == true) {
                document.getElementById("rp-title").innerText = `Report Phrase`
                document.getElementById("rp-message").innerText = `phrase`
            } else {
                document.getElementById("rp-title").innerText = `Report Phrase Translation`
                document.getElementById("rp-message").innerText = `phrase translation`
            }
            document.getElementById("rp-channel").innerText = `#phrase-reporting`
            document.getElementById("rp-btn").addEventListener('click', () => {
                window.open(reportPhraseChannelLink);
            })
        }
        else if (is_sentence != null) {
            if (is_sentence == true) {
                document.getElementById("rp-title").innerText = `Report Sentence`
                document.getElementById("rp-message").innerText = `sentence`
            }
            document.getElementById("rp-channel").innerText = `#sentence-reporting`
            document.getElementById("rp-btn").addEventListener('click', () => {
                window.open(reportSentenceChannelLink);
            })
        }
        rpOverlay.style.display = "block"
    }

    var existingWtranBtn = document.getElementById("existing-wtran-btn")
    var ewtransTable = document.getElementById("ewtrans-table")
    var ewtransTbody = document.getElementById("ewtrans-tbody")
    var ewtransAnnounce = document.getElementById("ewtrans-announce")
    existingWtranBtn.addEventListener('click', event => {
        document.getElementById("ewts-title").innerHTML = `
            <h2><strong>Existing ${language_speaking} Translations</strong></h2>
            <div style="font-size: 14px; color: #4f5660;"> of <strong>${existingWtranBtn.dataset.word}</strong></div>`

        fetch(getEwtransUrl + `?wordid=${existingWtranBtn.dataset.wordId}&lessonid=${lesson_id}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
        }).then(response => response.json())
            .then(response => {
                const gewts_success = response.is_success
                if (gewts_success == true) {
                    const word_id = response.word_id
                    const word = response.word
                    const ewtransArray = response.ewtrans_list
                    if (ewtransArray.length > 0) {
                        ewtransAnnounce.innerText = ``
                        ewtransTbody.innerHTML = ``
                        ewtransHandler(word, word_id, ewtransArray)
                    } else {
                        ewtransTbody.innerHTML = ``
                        ewtransAnnounce.innerText = `No word translations available. Come back and create a new one.`
                    }
                }
                else {
                    alert(`Oops! Something went wrong.`)
                }
            })
            .catch((error) => {
                console.log(error);
            });

        ewtsOverlay.style.display = "block"
    })

    document.querySelectorAll('.edit-wtran').forEach(editWtran => editWtran.addEventListener('click', () => {
        wtranHandler(editWtran.dataset.word, editWtran.dataset.wordId, editWtran.dataset.wtranId, false, false, true, false)
    }))

    var cfOverlay = document.getElementById("cf-overlay")
    var cfOverlayContent = document.getElementById("cf-overlay-content")

    function addWtranFetch(addElement) {
        var word = addElement.dataset.word
        var word_id = addElement.dataset.wordId
        var word_tran_id = addElement.dataset.wtranId
        fetch(addWtranUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify({
                'word_id': word_id,
                'word_tran_id': word_tran_id,
            }),
        })
            .then(response => response.json())
            .then(response => {
                var awt_success = response.is_success
                if (awt_success == true) {
                    const WordMissingTranTrs = document.querySelectorAll(`[data-word = "${word}"][data-wtis-missing = "true"]`)
                    if (WordMissingTranTrs.length > 0) {
                        const firstWordMissingTranTr = document.querySelector(`[data-word = "${word}"][data-wtis-missing = "true"]`);
                        WordsTBodyHandler(response, wordsTable.rows[firstWordMissingTranTr.rowIndex], false)
                        firstWordMissingTranTr.removeAttribute("data-wtis-missing")
                        firstWordMissingTranTr.setAttribute("data-wtran-tr-id", response.detail.word_tran_id)
                    } else {
                        WordsTBodyHandler(response, null, false);
                    }

                    const ewtranTrs = document.querySelectorAll(`[data-ewtran-tr-id = "${word_tran_id}"]`);
                    ewtranTrs.forEach(ewtranTr => {
                        EwtransTBodyHandler(response, ewtransTable.rows[ewtranTr.rowIndex], false)
                    })
                    alertThings.innerHTML = `
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            Added translation for word <strong>${word}</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>`
                    setTimeout(() => { alertThings.innerHTML = `` }, 6000);
                } else {
                    alert(`Oops! Something went wrong.`)
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }

    function removeWtranFetch(removeElement, is_in_ewtran) {
        var word = removeElement.dataset.word
        var word_id = removeElement.dataset.wordId
        var word_tran_id = removeElement.dataset.wtranId
        document.getElementById("cf-title").innerHTML = `
            <h5><strong>Remove Translation</strong></h5>`
        document.getElementById("cf-message").innerHTML = `
            Are you sure you want to remove this translation of <strong>${word}</strong>?`
        document.getElementById("cf-footer").innerHTML = `
            <div id="cf-cancel-btn" class="col btn" style="color: whitesmoke;"><u>Cancel</u></div>
            <button id="cf-remove-btn" class="col btn btn-danger" type="submit">
                Remove Translation
            </button>`
        cfOverlay.style.display = "block"

        document.getElementById("cf-cancel-btn").addEventListener('click', () => {
            cfOverlay.style.display = "none"
        })

        document.getElementById("cf-remove-btn").addEventListener('click', () => {
            fetch(removeWtranUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify({
                    'word_id': word_id,
                    'word_tran_id': word_tran_id,
                }),
            })
                .then(response => response.json())
                .then(response => {
                    const rwt_success = response.is_success
                    if (rwt_success == true) {
                        cfOverlay.style.display = "none"
                        const wordTrs = document.querySelectorAll(`[data-word-tr-id = "${word_id}"]`);
                        const wtranTrs = document.querySelectorAll(`[data-wtran-tr-id = "${word_tran_id}"]`);
                        if (wordTrs.length > 1) {
                            wtranTrs.forEach(wtranTr => {
                                wordsTable.deleteRow(wtranTr.rowIndex)
                            })
                        } else {
                            wtranTrs.forEach(wtranTr => {
                                WordsTBodyHandler({ "is_missing_tran": true, "word": word, "word_id": word_id, "detail": { "word_tran_id": null } }, wordsTable.rows[wtranTr.rowIndex], true)
                                wtranTr.removeAttribute("data-wtran-tr-id")
                            })
                        }

                        if (is_in_ewtran == true) {
                            const ewtranTrs = document.querySelectorAll(`[data-ewtran-tr-id = "${word_tran_id}"]`);
                            ewtranTrs.forEach(ewtranTr => {
                                EwtransTBodyHandler(response, ewtransTable.rows[ewtranTr.rowIndex], true)
                            })
                        }

                        alertThings.innerHTML = `
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                Removed translation of word <strong>${word}</strong>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>`
                        setTimeout(() => { alertThings.innerHTML = `` }, 6000);
                    } else { alert(`Oops! Something went wrong.`) }
                })
                .catch((error) => { });
        })

    }

    document.querySelectorAll('.remove-wtran').forEach(removeWtran => removeWtran.addEventListener('click', () => {
        removeWtranFetch(removeWtran, false)
    }))

    function deleteWtranFetch(deleteElement, is_in_ewtran) {
        var word = deleteElement.dataset.word
        var word_id = deleteElement.dataset.wordId
        var word_tran_id = deleteElement.dataset.wtranId
        document.getElementById("cf-title").innerHTML = `
            <h5><strong>Delete Translation</strong></h5>`
        document.getElementById("cf-message").innerHTML = `
            Are you sure you want to delete this translation of <strong>${word}</strong>?`
        document.getElementById("cf-footer").innerHTML = `
            <div id="cf-cancel-btn" class="col btn" style="color: whitesmoke;"><u>Cancel</u></div>
            <button id="cf-delete-btn" class="col btn btn-danger" type="submit">
                Delete Translation
            </button>`
        cfOverlay.style.display = "block"

        document.getElementById("cf-cancel-btn").addEventListener('click', () => {
            cfOverlay.style.display = "none"
        })

        document.getElementById("cf-delete-btn").addEventListener('click', () => {
            fetch(deleteWtranUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify({
                    'word_id': word_id,
                    'word_tran_id': word_tran_id,
                }),
            })
                .then(response => response.json())
                .then(response => {
                    const dwt_success = response.is_success
                    if (dwt_success) {
                        cfOverlay.style.display = "none"
                        const wordTrs = document.querySelectorAll(`[data-word-tr-id = "${word_id}"]`);
                        if (wordTrs.length > 1) {
                            const wtranTrs = document.querySelectorAll(`[data-wtran-tr-id = "${word_tran_id}"]`);
                            wtranTrs.forEach(wtranTr => {
                                wordsTable.deleteRow(wtranTr.rowIndex)
                            })
                        } else {
                            const wtranTrs = document.querySelectorAll(`[data-wtran-tr-id = "${word_tran_id}"]`);
                            wtranTrs.forEach(wtranTr => {
                                WordsTBodyHandler({ "is_missing_tran": true, "word": word, "word_id": word_id, "detail": { "word_tran_id": null } }, wordsTable.rows[wtranTr.rowIndex], true)
                                wtranTr.removeAttribute("data-wtran-tr-id")
                            })
                        }

                        if (is_in_ewtran == true) {
                            const ewtranTrs = document.querySelectorAll(`[data-ewtran-tr-id = "${word_tran_id}"]`);
                            ewtranTrs.forEach(ewtranTr => {
                                ewtransTable.deleteRow(ewtranTr.rowIndex)
                            })
                        }

                        alertThings.innerHTML = `
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                Deleted translation of word <strong>${word}</strong>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>`
                        setTimeout(() => { alertThings.innerHTML = `` }, 6000);
                    } else { alert(`Oops! Something went wrong.`) }
                })
                .catch((error) => { });
        })

    }


    document.querySelectorAll('.delete-wtran').forEach(deleteWtran => deleteWtran.addEventListener('click', () => {
        deleteWtranFetch(deleteWtran, false)
    }))

    function removeWordFetch(removeElement) {
        var word = removeElement.dataset.word
        var word_id = removeElement.dataset.wordId
        document.getElementById("cf-title").innerHTML = `
            <h5><strong>Remove Word</strong></h5>`
        document.getElementById("cf-message").innerHTML = `
            Are you sure you want to remove <strong>${word}</strong>? This cannot be undone.`
        document.getElementById("cf-footer").innerHTML = `
            <div id="cf-cancel-btn" class="col btn" style="color: whitesmoke;"><u>Cancel</u></div>
            <button id="cf-remove-btn" class="col btn btn-danger" type="submit">
                Remove Word
            </button>`
        cfOverlay.style.display = "block"

        document.getElementById("cf-cancel-btn").addEventListener('click', () => {
            cfOverlay.style.display = "none"
        })

        document.getElementById("cf-remove-btn").addEventListener('click', () => {
            fetch(removeWordURL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify({
                    'word_id': word_id,
                }),
            })
                .then(response => response.json())
                .then(response => {
                    const rw_success = response.is_success
                    if (rw_success == true) {
                        cfOverlay.style.display = "none"
                        const wordTrs = document.querySelectorAll(`[data-word-tr-id = "${word_id}"]`);
                        wordTrs.forEach(wordTr => {
                            wordsTable.deleteRow(wordTr.rowIndex)
                        })

                        document.querySelectorAll(`[data-word-str-id= "${word_id}"]`).forEach(wordTr => {
                            SearchWordTBodyHandler(word, word_id, wordTr, false)
                        })

                        alertThings.innerHTML = `
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            Removed word <strong>${word}</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>`
                        setTimeout(() => { alertThings.innerHTML = `` }, 6000);
                    } else { alert(`Oops! Something went wrong.`) }
                })
                .catch((error) => { });
        })

    }

    document.querySelectorAll('.remove-word').forEach(removeWord => removeWord.addEventListener('click', () => {
        removeWordFetch(removeWord)
    }))


</script>

<!--  -->
<script>
    var wordsTable = document.getElementById("words-table")
    var wordsTbody = document.getElementById("words-tbody")

    var phrasesTable = document.getElementById("phrases-table")
    var phrasesTbody = document.getElementById("phrases-tbody")

    var sentencesTable = document.getElementById("sentences-table")
    var sentencesTbody = document.getElementById("sentences-tbody")

    document.querySelectorAll("#words-table tbody tr").forEach(tr => tr.addEventListener("mouseover", () => {
        tr.querySelector('.sei').style.display = "block"
    }));

    document.querySelectorAll("#words-table tbody tr").forEach(tr => tr.addEventListener("mouseleave", () => {
        tr.querySelector('.sei').style.display = "none"
    }));

    function WordsTBodyHandler(wordObj, wtranTr, is_rede_wtran) {
        var tr = document.createElement("tr")
        tr.setAttribute("data-word", wordObj.word)
        tr.setAttribute("data-word-tr-id", wordObj.word_id)

        var td0 = document.createElement("td");
        var wordSpan = document.createElement("span");
        wordSpan.style.cssText = "font-size: 22px;"
        wordSpan.innerText = wordObj.word
        var posSmall = document.createElement("small");
        var posI = document.createElement("i");
        posI.setAttribute("data-toggle", "tooltip")
        posI.setAttribute("data-placement", "top")
        posI.title = "Part Of Speech"
        posSmall.appendChild(posI)

        var ipasSmall = document.createElement("small");
        var speakerSpan = document.createElement("span");
        speakerSpan.classList.add("speaker")
        speakerSpan.setAttribute("data-text", wordObj.word)
        speakerSpan.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                class="bi bi-volume-up" viewBox="0 0 16 16" style="color: white; cursor: pointer;">
                <path
                    d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z" />
                <path
                    d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z" />
                <path
                    d="M10.025 8a4.486 4.486 0 0 1-1.318 3.182L8 10.475A3.489 3.489 0 0 0 9.025 8c0-.966-.392-1.841-1.025-2.475l.707-.707A4.486 4.486 0 0 1 10.025 8zM7 4a.5.5 0 0 0-.812-.39L3.825 5.5H1.5A.5.5 0 0 0 1 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 7 12V4zM4.312 6.39 6 5.04v5.92L4.312 9.61A.5.5 0 0 0 4 9.5H2v-3h2a.5.5 0 0 0 .312-.11z" />
            </svg>`
        speakerSpan.addEventListener('click', () => { speakS(speakerSpan.dataset.text) });
        var ipaI = document.createElement("i");
        ipaI.setAttribute("data-toggle", "tooltip")
        ipaI.setAttribute("data-placement", "top")
        ipaI.title = "International Phonetic Alphabet"

        ipasSmall.append(speakerSpan, ipaI)
        var br1 = document.createElement("br");
        var br2 = document.createElement("br");
        td0.append(wordSpan, br1, posSmall, br2, ipasSmall)

        var td1 = document.createElement("td");
        var td2 = document.createElement("td");
        var wrapperDiv = document.createElement("div");
        wrapperDiv.classList.add("sei")
        wrapperDiv.style.cssText = "display: none;"

        var addWtranDiv = document.createElement("div");
        addWtranDiv.classList.add("add-wtran", "ei")
        addWtranDiv.setAttribute("data-toggle", "tooltip")
        addWtranDiv.setAttribute("data-placement", "top")
        addWtranDiv.setAttribute("data-word", wordObj.word)
        addWtranDiv.setAttribute("data-word-id", wordObj.word_id)
        addWtranDiv.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                class="bi bi-plus-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
            </svg>`
        addWtranDiv.addEventListener('click', () => {
            uorcWtran(addWtranDiv)
        });

        var editWtranDiv = document.createElement("div");
        editWtranDiv.classList.add("edit-wtran", "ei")
        editWtranDiv.title = "Edit Translation"
        editWtranDiv.setAttribute("data-toggle", "tooltip")
        editWtranDiv.setAttribute("data-placement", "top")
        editWtranDiv.setAttribute("data-word", wordObj.word)
        editWtranDiv.setAttribute("data-word-id", wordObj.word_id)
        editWtranDiv.setAttribute("data-wtran-id", wordObj.detail.word_tran_id)

        editWtranDiv.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                class="bi bi-pencil" viewBox="0 0 16 16">
                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z" />
            </svg>`
        editWtranDiv.addEventListener('click', () => {
            wtranHandler(editWtranDiv.dataset.word, editWtranDiv.dataset.wordId, editWtranDiv.dataset.wtranId, false, false, true, false)
        });

        var deleteWtranDiv = document.createElement("div");
        deleteWtranDiv.classList.add("delete-wtran", "ei")
        deleteWtranDiv.title = "Delete Translation"
        deleteWtranDiv.setAttribute("data-toggle", "tooltip")
        deleteWtranDiv.setAttribute("data-placement", "top")
        deleteWtranDiv.setAttribute("data-bs-original-title", "Delete Translation")
        deleteWtranDiv.setAttribute("data-word", wordObj.word)
        deleteWtranDiv.setAttribute("data-word-id", wordObj.word_id)
        deleteWtranDiv.setAttribute("data-wtran-id", wordObj.detail.word_tran_id)
        deleteWtranDiv.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                class="bi bi-trash text-danger" viewBox="0 0 16 16">
                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
            </svg>`
        deleteWtranDiv.addEventListener('click', () => {
            deleteWtranFetch(deleteWtranDiv, false)
        });

        var removeWtranDiv = document.createElement("div");
        removeWtranDiv.classList.add("remove-wtran", "ei")
        removeWtranDiv.title = "Remove Translation"
        removeWtranDiv.setAttribute("data-toggle", "tooltip")
        removeWtranDiv.setAttribute("data-placement", "top")
        removeWtranDiv.setAttribute("data-bs-original-title", "Remove Translation")
        removeWtranDiv.setAttribute("data-word", wordObj.word)
        removeWtranDiv.setAttribute("data-word-id", wordObj.word_id)
        removeWtranDiv.setAttribute("data-wtran-id", wordObj.detail.word_tran_id)
        removeWtranDiv.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                class="bi bi-x-circle text-danger" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
            </svg>`
        removeWtranDiv.addEventListener('click', () => {
            removeWtranFetch(removeWtranDiv, false)
        });

        var removeWordDiv = document.createElement("div");
        removeWordDiv.classList.add("remove-word", "ei")
        removeWordDiv.title = "Remove Word"
        removeWordDiv.setAttribute("data-toggle", "tooltip")
        removeWordDiv.setAttribute("data-placement", "top")
        removeWordDiv.setAttribute("data-word", wordObj.word)
        removeWordDiv.setAttribute("data-word-id", wordObj.word_id)
        removeWordDiv.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                class="bi bi-x-lg text-danger" viewBox="0 0 16 16">
                <path
                    d="M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z" />
            </svg>`
        removeWordDiv.addEventListener('click', () => {
            removeWordFetch(removeWordDiv)
        });

        if (wordObj.is_missing_tran == true || is_rede_wtran == true) {
            tr.setAttribute("data-wtis-missing", "true")
            posI.innerText = `-`
            posI.classList.add("text-danger")
            ipaI.innerText = `-`
            ipaI.classList.add("text-danger")
            td1.innerText = `-`
            td1.classList.add("text-danger")
            addWtranDiv.title = "Add Translation"

            wrapperDiv.append(addWtranDiv, removeWordDiv)
        }
        else {
            tr.setAttribute("data-wtran-tr-id", wordObj.detail.word_tran_id)
            posI.innerText = wordObj.detail.pos
            ipaI.innerText = wordObj.detail.ipa

            var meaningDiv = document.createElement("div");
            meaningDiv.innerText = "Meaning: "
            wordObj.detail.meaning.forEach(meaning => {
                var pre = document.createElement("pre");
                pre.innerText = `    ${meaning}`
                meaningDiv.appendChild(pre)
            });
            var defDiv = document.createElement("div");
            defDiv.innerText = `Definition: ${wordObj.detail.def}`
            var nodeDiv = document.createElement("div");
            nodeDiv.innerText = `Node: ${wordObj.detail.node}`
            var creatorDiv = document.createElement("div");
            creatorDiv.innerText = `Creator: `
            var creatorA = document.createElement("a");
            creatorA.innerText = wordObj.detail.creator
            creatorA.style.cssText = "cursor: pointer;"
            creatorA.classList.add("link-light")
            creatorA.href = `/profile/${wordObj.detail.creator}`
            creatorDiv.appendChild(creatorA)
            var hrDiv1 = document.createElement("div");
            hrDiv1.style.cssText = "border-top: thin solid; margin: 1% 0 1% 0"
            var hrDiv2 = document.createElement("div");
            hrDiv2.style.cssText = "border-top: thin solid; margin: 1% 0 1% 0"
            var hrDiv3 = document.createElement("div");
            hrDiv3.style.cssText = "border-top: thin solid; margin: 1% 0 1% 0"
            addWtranDiv.title = "Add Another Translation"

            td1.append(meaningDiv, hrDiv1, defDiv, hrDiv2, nodeDiv, hrDiv3, creatorDiv)
            if (wordObj.detail.is_creator == true) {
                wrapperDiv.append(addWtranDiv, editWtranDiv, deleteWtranDiv, removeWordDiv)
            } else {
                wrapperDiv.append(addWtranDiv, removeWtranDiv, removeWordDiv)
            }
        }
        td2.appendChild(wrapperDiv)

        if (wtranTr == null) {
            tr.append(td0, td1, td2)
            wordsTbody.appendChild(tr)
            window.scrollTo(0, document.body.scrollHeight);

            tr.addEventListener("mouseover", () => {
                tr.querySelector('.sei').style.display = "block"
            })

            tr.addEventListener("mouseleave", () => {
                tr.querySelector('.sei').style.display = "none"
            })
        }
        else {
            if (is_rede_wtran == true) {
                wtranTr.setAttribute("data-wtis-missing", "true")
            }

            wtranTr.innerHTML = ``
            wtranTr.append(td0, td1, td2)
        }

        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    }

    function EwtransTBodyHandler(wordObj, ewtranTr, is_remove) {

        var td0 = document.createElement("td");
        var posSmall = document.createElement("small");
        var posI = document.createElement("i");
        posI.title = "Part Of Speech"
        posI.innerText = wordObj.detail.pos
        posSmall.appendChild(posI)

        var ipasSmall = document.createElement("small");
        var speakerSpan = document.createElement("span");
        speakerSpan.classList.add("speaker")
        speakerSpan.setAttribute("data-text", wordObj.word)
        speakerSpan.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor"
                class="bi bi-volume-up" viewBox="0 0 16 16" style="color: white; cursor: pointer;">
                <path
                    d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z" />
                <path
                    d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z" />
                <path
                    d="M10.025 8a4.486 4.486 0 0 1-1.318 3.182L8 10.475A3.489 3.489 0 0 0 9.025 8c0-.966-.392-1.841-1.025-2.475l.707-.707A4.486 4.486 0 0 1 10.025 8zM7 4a.5.5 0 0 0-.812-.39L3.825 5.5H1.5A.5.5 0 0 0 1 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 7 12V4zM4.312 6.39 6 5.04v5.92L4.312 9.61A.5.5 0 0 0 4 9.5H2v-3h2a.5.5 0 0 0 .312-.11z" />
            </svg>`
        speakerSpan.addEventListener('click', () => { speakS(speakerSpan.dataset.text) });

        var ipaI = document.createElement("i");
        ipaI.title = "International Phonetic Alphabet"
        ipaI.innerText = wordObj.detail.ipa

        ipasSmall.append(speakerSpan, ipaI)
        var br2 = document.createElement("br");
        td0.append(posSmall, br2, ipasSmall)

        var td1 = document.createElement("td");
        var meaningDiv = document.createElement("div");
        meaningDiv.innerText = "Meaning: "
        wordObj.detail.meaning.forEach(meaning => {
            var pre = document.createElement("pre");
            pre.innerText = `    ${meaning}`
            meaningDiv.appendChild(pre)
        });
        var defDiv = document.createElement("div");
        defDiv.innerText = `Definition: ${wordObj.detail.def}`
        var nodeDiv = document.createElement("div");
        nodeDiv.innerText = `Node: ${wordObj.detail.node}`
        var creatorDiv = document.createElement("div");
        creatorDiv.innerText = `Creator: `
        var creatorA = document.createElement("a");
        creatorA.innerText = wordObj.detail.creator
        creatorA.style.cssText = "cursor: pointer;"
        creatorA.classList.add("link-light")
        creatorA.href = `/profile/${wordObj.detail.creator}`
        creatorDiv.appendChild(creatorA)
        var hrDiv1 = document.createElement("div");
        hrDiv1.style.cssText = "border-top: thin solid; margin: 1% 0 1% 0"
        var hrDiv2 = document.createElement("div");
        hrDiv2.style.cssText = "border-top: thin solid; margin: 1% 0 1% 0"
        var hrDiv3 = document.createElement("div");
        hrDiv3.style.cssText = "border-top: thin solid; margin: 1% 0 1% 0"
        td1.append(meaningDiv, hrDiv1, defDiv, hrDiv2, nodeDiv, hrDiv3, creatorDiv)

        var td2 = document.createElement("td");
        var userUsingDiv = document.createElement("div");
        userUsingDiv.style.cssText = "text-align: center;"
        userUsingDiv.innerText = `${wordObj.detail.user_using}`
        td2.appendChild(userUsingDiv)

        var td3 = document.createElement("td");
        var addEwtranDiv = document.createElement("div");
        addEwtranDiv.classList.add("add-ewtran", "ei", "tultip")
        addEwtranDiv.setAttribute("data-word", wordObj.word)
        addEwtranDiv.setAttribute("data-word-id", wordObj.word_id)
        addEwtranDiv.setAttribute("data-wtran-id", wordObj.detail.word_tran_id)
        addEwtranDiv.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
            </svg>
            <span class="tultip-content">Add Translation</span>`
        addEwtranDiv.addEventListener('click', () => {
            addWtranFetch(addEwtranDiv)
        });

        var editEwtranDiv = document.createElement("div");
        editEwtranDiv.classList.add("edit-ewtran", "ei", "tultip")
        editEwtranDiv.setAttribute("data-word", wordObj.word)
        editEwtranDiv.setAttribute("data-word-id", wordObj.word_id)
        editEwtranDiv.setAttribute("data-wtran-id", wordObj.detail.word_tran_id)
        editEwtranDiv.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z" />
            </svg>
            <span class="tultip-content">Edit Translation</span>`
        editEwtranDiv.addEventListener('click', () => {
            wtranHandler(editEwtranDiv.dataset.word, editEwtranDiv.dataset.wordId, editEwtranDiv.dataset.wtranId, false, false, true, true)
        });

        var removeEwtranDiv = document.createElement("div");
        removeEwtranDiv.classList.add("remove-ewtran", "ei", "tultip")
        removeEwtranDiv.setAttribute("data-word", wordObj.word)
        removeEwtranDiv.setAttribute("data-word-id", wordObj.word_id)
        removeEwtranDiv.setAttribute("data-wtran-id", wordObj.detail.word_tran_id)
        removeEwtranDiv.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-circle text-danger" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
            </svg>
            <span class="tultip-content" style="width: 160px; margin-left: -80px;">Remove Translation</span>`
        removeEwtranDiv.addEventListener('click', () => {
            removeWtranFetch(removeEwtranDiv, true)
        });

        var deleteEwtranDiv = document.createElement("div");
        deleteEwtranDiv.classList.add("delete-ewtran", "ei", "tultip")
        deleteEwtranDiv.setAttribute("data-word", wordObj.word)
        deleteEwtranDiv.setAttribute("data-word-id", wordObj.word_id)
        deleteEwtranDiv.setAttribute("data-wtran-id", wordObj.detail.word_tran_id)
        deleteEwtranDiv.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash text-danger" viewBox="0 0 16 16">
            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
        </svg>
        <span class="tultip-content" style="width: 160px; margin-left: -80px;">Delete Translation</span>`
        deleteEwtranDiv.addEventListener('click', () => {
            deleteWtranFetch(deleteEwtranDiv, true)
        });


        if (wordObj.detail.is_creator == true) {
            td3.append(editEwtranDiv, deleteEwtranDiv)
        } else {
            if (is_remove == true) {
                td3.appendChild(addEwtranDiv)
            } else {
                td3.appendChild(removeEwtranDiv)
            }
        }

        var td4 = document.createElement("td");
        var reportEwtranDiv = document.createElement("div");
        reportEwtranDiv.classList.add("report-ewtran", "ei", "tultip")
        reportEwtranDiv.setAttribute("data-word", wordObj.word)
        reportEwtranDiv.setAttribute("data-word-id", wordObj.word_id)
        reportEwtranDiv.setAttribute("data-wtran-id", wordObj.detail.word_tran_id)
        reportEwtranDiv.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-flag" viewBox="0 0 16 16">
                <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21.294 21.294 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.29 9.86 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21.317 21.317 0 0 0 14 7.655V1.222z"/>
            </svg>
            <span class="tultip-content" style="width: 142px; margin-left: -71px;">Report Translation</span>`
        reportEwtranDiv.addEventListener('click', () => { reportHandler(false, null, null) });

        td4.appendChild(reportEwtranDiv)

        ewtranTr.innerHTML = ``
        ewtranTr.append(td0, td1, td2, td3, td4)
    }

</script>

<!-- Search overlay's events -->
<script>
    var addWordBtn = document.getElementById("add-word-btn")
    var addPhraseBtn = document.getElementById("add-phrase-btn")
    var addSentenceBtn = document.getElementById("add-sentence-btn")

    var searchWordInput = document.getElementById("search-word-input")
    var searchPhraseInput = document.getElementById("search-phrase-input")
    var sentenceQ = document.getElementById("search-sentence-input")

    var searchWordBtn = document.getElementById("search-word-btn")
    var searchPhraseBtn = document.getElementById("search-phrase-btn")
    var searchSentenceBtn = document.getElementById("search-sentence-btn")

    addWordBtn.addEventListener('click', () => {
        searchOverlay.style.display = "block";
        if (searchWordSection.style.display == 'none') {
            srchWordBtn.classList.replace("btn-outline-secondary", "btn-secondary")
            srchPhraseBtn.classList.replace("btn-secondary", "btn-outline-secondary")
            srchSentenceBtn.classList.replace("btn-secondary", "btn-outline-secondary")

            searchWordSection.style.display = "block";
            searchWordInput.focus()
            searchPhraseSection.style.display = "none";
            searchSentenceSection.style.display = "none";
        }
    })

    addPhraseBtn.addEventListener('click', () => {
        searchOverlay.style.display = "block";
        if (searchPhraseSection.style.display == 'none') {
            srchPhraseBtn.classList.replace("btn-outline-secondary", "btn-secondary")
            srchWordBtn.classList.replace("btn-secondary", "btn-outline-secondary")
            srchSentenceBtn.classList.replace("btn-secondary", "btn-outline-secondary")

            searchPhraseSection.style.display = "block";
            searchPhraseInput.focus()
            searchWordSection.style.display = "none";
            searchSentenceSection.style.display = "none";
        }
    })

    addSentenceBtn.addEventListener('click', () => {
        searchOverlay.style.display = "block";
        if (searchSentenceSection.style.display == 'none') {
            srchSentenceBtn.classList.replace("btn-outline-secondary", "btn-secondary")
            srchWordBtn.classList.replace("btn-secondary", "btn-outline-secondary")
            srchPhraseBtn.classList.replace("btn-secondary", "btn-outline-secondary")

            searchSentenceSection.style.display = "block";
            sentenceQ.focus()
            searchWordSection.style.display = "none";
            searchPhraseSection.style.display = "none";
        }
    })

    var searchOverlay = document.getElementById("search-overlay")
    var searchOverlayContent = document.getElementById("search-overlay-content")
    var closeSearchOverlayBtns = document.querySelectorAll('.close-search-overlay-btn');
    closeSearchOverlayBtns.forEach(closeSearchOverlayBtn => closeSearchOverlayBtn.addEventListener("click", () => {
        searchOverlay.style.display = "none";
    }));

    document.addEventListener("keydown", (event) => {
        if (event.keyCode == 27) {
            searchOverlay.style.display = "none";
        }
    })

    var srchWordBtn = document.getElementById("srch-word-btn")
    //var srchWordbyTextBtn = document.getElementById("srch-word-byText-btn")
    var srchPhraseBtn = document.getElementById("srch-phrase-btn")
    var srchSentenceBtn = document.getElementById("srch-sentence-btn")

    var searchWordSection = document.getElementById("search-word-section")
    //var searchWordbyTextSection = document.getElementById("search-word-byText-section")
    var searchPhraseSection = document.getElementById("search-phrase-section")
    var searchSentenceSection = document.getElementById("search-sentence-section")

    srchWordBtn.addEventListener('click', () => {
        searchOverlay.style.display = "block";
        if (searchWordSection.style.display == 'none') {
            srchWordBtn.classList.replace("btn-outline-secondary", "btn-secondary")
            srchPhraseBtn.classList.replace("btn-secondary", "btn-outline-secondary")
            srchSentenceBtn.classList.replace("btn-secondary", "btn-outline-secondary")

            searchWordSection.style.display = "block";
            searchWordInput.focus()
            searchPhraseSection.style.display = "none";
            searchSentenceSection.style.display = "none";
        }
        else {
            searchWordSection.style.display = "none";
            srchWordBtn.classList.replace("btn-secondary", "btn-outline-secondary")
        }
    })

    srchPhraseBtn.addEventListener('click', () => {
        searchOverlay.style.display = "block";
        if (searchPhraseSection.style.display == 'none') {
            srchPhraseBtn.classList.replace("btn-outline-secondary", "btn-secondary")
            srchWordBtn.classList.replace("btn-secondary", "btn-outline-secondary")
            srchSentenceBtn.classList.replace("btn-secondary", "btn-outline-secondary")

            searchPhraseSection.style.display = "block";
            searchPhraseInput.focus()
            searchWordSection.style.display = "none";
            searchSentenceSection.style.display = "none";
        }
        else {
            searchPhraseSection.style.display = "none";
            srchPhraseBtn.classList.replace("btn-secondary", "btn-outline-secondary")
        }
    })

    srchSentenceBtn.addEventListener('click', () => {
        searchOverlay.style.display = "block";
        if (searchSentenceSection.style.display == 'none') {
            srchSentenceBtn.classList.replace("btn-outline-secondary", "btn-secondary")
            srchWordBtn.classList.replace("btn-secondary", "btn-outline-secondary")
            srchPhraseBtn.classList.replace("btn-secondary", "btn-outline-secondary")

            searchSentenceSection.style.display = "block";
            sentenceQ.focus()
            searchWordSection.style.display = "none";
            searchPhraseSection.style.display = "none";
        }
        else {
            searchSentenceSection.style.display = "none";
            srchSentenceBtn.classList.replace("btn-secondary", "btn-outline-secondary")
        }
    })



    var searchPhrase = document.getElementById("search-phrase")
    var phraseResults = document.getElementById("phrase-results")

    var searchSentence = document.getElementById("search-sentence")
    var sentenceResults = document.getElementById("sentence-results")

    var phraseResultsTbody = document.getElementById("phrase-results-tbody")
    var sentenceResultsTbody = document.getElementById("sentence-results-tbody")


    function isLetter(str) {
        var char, i, len;
        for (i = 0, len = str.length; i < len; i++) {
            char = str[i];
            if (char.toLowerCase() != char.toUpperCase()) {
                continue;
            }
            else {
                return false;
                break;
            }
        }
        return true;
    }

    function isAlphaNumeric(str) {
        var code, i, len;

        for (i = 0, len = str.length; i < len; i++) {
            code = str.charCodeAt(i);
            if (!(code > 47 && code < 58) && // numeric (0-9)
                !(code > 64 && code < 91) && // upper alpha (A-Z)
                !(code > 96 && code < 123)) { // lower alpha (a-z)
                return false;
            }
        }
        return true;
    };


    var createNewordtranBtn = document.getElementById("cnew-wt-btn")
    createNewordtranBtn.addEventListener("click", () => {
        wtOverlay.style.display = "block"
        wtranHandler(createNewordtranBtn.dataset.word, null, null, true, false, false, false)
    })

    var createNewphrasetranBtn = document.getElementById("cnew-pt-btn")
    createNewphrasetranBtn.addEventListener("click", () => {
        // ptOverlay.style.display = "block"
        // wtranHandler(createNewphrasetranBtn.dataset.phrase, null, null, true, false, false, false)
    })

    var waddTimes = document.getElementById("wadd-times")
    waddTimes.innerText = 3 - words_created
    if (waddTimes.textContent == 0) {
        createNewordtranBtn.disabled = true
    }

    var paddTimes = document.getElementById("padd-times")
    paddTimes.innerText = 3 - words_created
    if (paddTimes.textContent == 0) {
        createNewphrasetranBtn.disabled = true
    }

    const requestNewordChannelLink = `https://discord.gg/fr3e6ntjXX`
    document.getElementById("rqnew-word-btn").addEventListener("click", () => {
        window.open(requestNewordChannelLink);
    })


    var timeCountDown = setInterval(function () {
        var second = seconds_left--
        //var days = Math.floor(second / (60 * 60 * 24));
        var hours = Math.floor((second % (60 * 60 * 24)) / (60 * 60));
        var minutes = Math.floor((second % (60 * 60)) / 60);
        var seconds = Math.floor(second % 60);

        document.querySelectorAll(".timer-countdown").forEach(timer => {
            timer.innerText = `${hours}:${minutes}:${seconds}`
        })
        //document.getElementById("timer-countdown").innerText = `${hours}:${minutes}:${seconds}`

        if (seconds_left < 0) {
            seconds_left = 86400
            waddTimes.innerText = 3
            createNewordtranBtn.disabled = false
        }
    }, 1000);

    document.querySelectorAll(`[data-word-str-id]`).forEach(wordTr => {
        wordTr.addEventListener("mouseover", () => {
            wordTr.querySelector('.sreport-word').style.display = "block"
        })

        wordTr.addEventListener("mouseleave", () => {
            wordTr.querySelector('.sreport-word').style.display = "none"
        })
    })

    document.querySelectorAll(`.sreport-word`).forEach(sreportWord => {
        sreportWord.addEventListener("click", () => { reportHandler(true, null, null) })
    })


    var wordSrchTable = document.getElementById("word-stable")
    var wordSearchAlert = document.getElementById("word-search-alert")

    function SearchWordTBodyHandler(word, word_id, Trow, is_learning) {
        var td0 = document.createElement("td");
        var wordDiv = document.createElement("div");
        wordDiv.innerText = word
        td0.appendChild(wordDiv)

        var td1 = document.createElement("td");
        var removeWordDiv = document.createElement("div");
        removeWordDiv.classList.add("sremove-word", "ei", "tultip")
        removeWordDiv.setAttribute("data-word", word)
        removeWordDiv.setAttribute("data-word-id", word_id)
        removeWordDiv.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-lg text-danger" viewBox="0 0 16 16">
            <path d="M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z" />
        </svg>
        <span class="tultip-content" style="width: 142px; margin-left: -71px;">Remove Word</span>`
        removeWordDiv.addEventListener('click', () => { removeWordFetch(removeWordDiv) });

        var addWordDiv = document.createElement("div");
        addWordDiv.classList.add("sadd-word", "ei", "tultip")
        addWordDiv.setAttribute("data-word", word)
        addWordDiv.setAttribute("data-word-id", word_id)
        addWordDiv.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
            class="bi bi-plus-lg" viewBox="0 0 16 16">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z" fill="#000" />
        </svg>
        <span class="tultip-content" style="width: 142px; margin-left: -71px;">Add Word</span>`
        addWordDiv.addEventListener('click', () => { addWordFetch(addWordDiv) });

        if (is_learning == true) {
            td1.appendChild(removeWordDiv)
        } else {
            td1.appendChild(addWordDiv)
        }

        var td2 = document.createElement("td");
        var reportWordDiv = document.createElement("div");
        reportWordDiv.classList.add("sreport-word", "ei", "tultip")
        reportWordDiv.cssText = "display: none;"
        reportWordDiv.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-flag" viewBox="0 0 16 16">
            <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21.294 21.294 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.29 9.86 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21.317 21.317 0 0 0 14 7.655V1.222z" />
        </svg>
        <span class="tultip-content" style="width: 142px; margin-left: -71px;">Report Word</span>`
        reportWordDiv.addEventListener('click', () => { reportHandler(true, null, null) });

        td2.appendChild(reportWordDiv)
        if (Trow == null) {
            var tr = document.createElement("tr");
            tr.classList.add("search-tr")
            tr.setAttribute("data-word", word)
            tr.setAttribute("data-word-str-id", word_id)
            tr.append(td0, td1, td2)

            tr.addEventListener("mouseover", () => {
                tr.querySelector('.sreport-word').style.display = "block"
            })

            tr.addEventListener("mouseleave", () => {
                tr.querySelector('.sreport-word').style.display = "none"
            })
            wordSrchTable.appendChild(tr)
        } else {
            Trow.innerHTML = ``
            Trow.append(td0, td1, td2)
        }
    }

    document.querySelectorAll('.sremove-word').forEach(sremoveWord => sremoveWord.addEventListener('click', () => {
        removeWordFetch(sremoveWord)
    }))

    function addWordFetch(addElement) {
        var word = addElement.dataset.word
        var word_id = addElement.dataset.wordId
        fetch(addWordURL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify({
                'word_id': word_id,
            }),
        })
            .then(response => response.json())
            .then(response => {
                var aw_success = response.is_success
                if (aw_success == true) {
                    var wtranArray = response.word_tran_list
                    if (wtranArray.length > 0) {
                        wtranArray.forEach(wtran => {
                            WordsTBodyHandler(wtran, null, false)
                        });
                    }

                    document.querySelectorAll(`[data-word-str-id= "${word_id}"]`).forEach(wordTr => {
                        SearchWordTBodyHandler(word, word_id, wordTr, true)
                    })

                    alertThings.innerHTML = `
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            Added word <strong>${word}</strong> 
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>  `

                    setTimeout(() => {
                        alertThings.innerHTML = ``
                    }, 6000);
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }

    document.querySelectorAll('.sadd-word').forEach(saddWord => saddWord.addEventListener('click', event => {
        addWordFetch(saddWord)
    }));

    var wordSearchAnnounce = document.getElementById("word-search-announce")
    var wordMatched = document.getElementById("word-matched")
    searchWordInput.addEventListener("input", () => {
        var searchWordValue = searchWordInput.value.trim()
        if (searchWordValue.indexOf(' ') >= 0 || isLetter(searchWordValue) === false) {
            wordSearchAlert.innerHTML = `
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    Your word can not contain special characters or numbers
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>`
            searchWordInput.focus()
        }
        else {
            var is_match = 0
            wordSearchAlert.innerHTML = ``
            var wordTrsSearch = document.querySelectorAll(`[data-word-str-id]`).forEach(wordTr => {
                if (wordTr.dataset.word.includes(searchWordValue.toLowerCase())) {
                    is_match++
                }
            })
            //wordsMatchArray = wordTrsSearch.filter(x => x.dataset.word.includes(searchWordValue))

            if (is_match > 0) {
                wordMatched.style.display = 'block'
                wordSearchAnnounce.style.display = 'none'
                searchHandler(wordSrchTable, searchWordValue.toUpperCase(), true, false)
            } else {
                wordMatched.style.display = 'none'
                wordSearchAnnounce.style.display = 'block'
                createNewordtranBtn.setAttribute("data-word", searchWordValue.toLowerCase())
                document.querySelectorAll(".ws-word").forEach(wsWord => {
                    wsWord.innerText = searchWordValue.toLowerCase()
                })

            }
        }
    })

    var phraseSearchAnnounce = document.getElementById("phrase-search-announce")
    var phraseMatched = document.getElementById("phrase-matched")
    searchPhraseInput.addEventListener("input", () => {
        var searchPhraseValue = searchPhraseInput.value.trim()
        if (!isLetter(searchPhraseValue.replaceAll(' ', ''))) {
            phraseSearchAlert.innerHTML = `
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    Your phrase can not contain special characters or numbers
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>`
            searchPhraseInput.focus()
        } // searchPhraseValue.indexOf(' ') >= 0 || 
        else {
            var is_match = 0
            phraseSearchAlert.innerHTML = ``
            var phraseTrsSearch = document.querySelectorAll(`[data-phrase-str-id]`).forEach(phraseTr => {
                if (phraseTr.dataset.phrase.includes(searchPhraseValue.toLowerCase())) {
                    is_match++
                }
            })
            //phrasesMatchArray = phraseTrsSearch.filter(x => x.dataset.phrase.includes(searchPhraseValue))

            if (is_match > 0) {
                phraseMatched.style.display = 'block'
                phraseSearchAnnounce.style.display = 'none'
                searchHandler(phraseSrchTable, searchPhraseValue.toUpperCase(), true, false)
            } else {
                phraseMatched.style.display = 'none'
                phraseSearchAnnounce.style.display = 'block'
                createNewphrasetranBtn.setAttribute("data-phrase", searchPhraseValue.toLowerCase())
                document.querySelectorAll(".ps-phrase").forEach(psPhrase => {
                    psPhrase.innerText = searchPhraseValue.toLowerCase()
                })

            }
        }
    })


    var phraseSearchAlert = document.getElementById("phrase-search-alert")
    var sentenceSearchAlert = document.getElementById("sentence-search-alert")
    function searchPhraseFunc() {
        var phrase_q = searchPhraseInput.value.trim()

        phraseResults.style.display = 'block'
        searchPhraseInput.focus()

        searchPhraseURL = `/lessons/${lesson_id}/phrases/search/`
        fetch(searchPhraseURL, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify({
                'phrase_q': phrase_q,
            })
        })
            .then(response => response.json())
            .then(response => {
                phraseSearchAlertDiv.innerHTML = ``
                phraseResultsTbody.innerHTML = ''
                const phraseResults = response.data
                const phraseExist = response.phrase_exist

                new_phrase = `
                    <tr>
                        <td id="newphrase-tran" style="display: none;">
                            <div class="form-group" style="text-align: left;">
                                <label for="phrase-input">*New phrase:</label>
                                <input type="text" class="form-control" id="phrase-input">
                                <label for="phrase-ipa">IPA:</label>
                                <input type="text" class="form-control" id="phrase-ipa">
                                <label for="phrase-meaning">*Meaning:</label>
                                <button id="add-phrase-meaning-btn" class="btn btn-outline-success">Add meaning</button>
                                <div id="phrase-meanings">
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control phrase-meaning"
                                            placeholder="Meaning in ${language_speaking}">
                                        <button class="input-group-append btn btn-outline-danger remove-phrase-meaning-btn" type="button">Remove</button>
                                    </div>
                                </div>
                                <label for="phrase-def">Definition:</label>
                                <input type="text" class="form-control" id="phrase-def">
                                <label for="phrase-node">Node:</label>
                                <input type="text" class="form-control" id="phrase-node">
                            </div>
                            </td>
                        <td>
                            <button type="submit" id="save-phrase-tran-btn" class="btn btn-secondary">Save</button>
                        </td>
                    </tr>`

                if (!phraseExist && phrase_q.indexOf(' ') >= 0) {
                    phraseResultsTbody.innerHTML = `
                        <tr id="alert-tr-phrase">
                            <td>
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    This course does not have any phrase like <strong>${phrase_q}</strong>
                                    <button class="add-phrase-tran-btn btn btn-secondary" style="margin-left: 20px;">Add new phrase?</button>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            </td>
                        </tr>`
                    phraseResultsTbody.innerHTML += new_phrase
                }
                if (phraseResults.length > 0) {
                    phraseResults.map(phr => {
                        if (phr.learning) {
                            phraseResultsTbody.innerHTML += `
                                <tr>
                                    <td>
                                        <a class="link-secondary" href="/phrases/${phr.id}/detail/">${phr.phrase}</a>
                                    </td>
                                    <td>
                                        <button class="btn btn-success" disabled>Added</button>
                                    </td>
                                </tr>`
                        }
                        else {
                            phraseResultsTbody.innerHTML += `
                                <tr>
                                    <td>
                                        <a class="link-secondary" href="/phrases/${phr.id}/detail/">${phr.phrase}</a>
                                    </td>
                                    <td>
                                        <button class="add-phrase-btn btn btn-secondary" id="${phr.id}" title="Add to my lesson">Add</button>
                                    </td>
                                </tr>`
                        }
                    })
                }
                else {
                    phraseResultsTbody.innerHTML = `
                        <tr id="alert-tr-phrase">
                            <td>
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    There is no phrase contain <strong>${phrase_q}</strong>
                                    <button class="add-phrase-tran-btn btn btn-secondary" style="margin-left: 20px;">Add new phrase?</button>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            </td>
                        </tr>`
                    phraseResultsTbody.innerHTML += new_phrase
                }

                if (!phraseExist) {
                    var newPhraseTran = document.getElementById("newphrase-tran")
                    var newPhraseIPA = document.getElementById("phrase-ipa")
                    var newPhraseMeaning = document.getElementById("phrase-meaning")
                    var newPhraseDefinition = document.getElementById("phrase-def")
                    var newPhraseNode = document.getElementById("phrase-node")
                    var savePhraseTranBtn = document.getElementById("save-phrase-tran-btn")

                    var phraseMeanings = document.getElementById("phrase-meanings")
                    var addPhraseMeaningBtn = document.getElementById("add-phrase-meaning-btn")
                    var removePhraseMeaningBtns = document.querySelectorAll('.remove-phrase-meaning-btn');
                    removePhraseMeaningBtns.forEach(removePhraseMeaningBtn => removePhraseMeaningBtn.addEventListener('click', event => {
                        if (phraseMeanings.childElementCount > 1) {
                            removePhraseMeaningBtn.parentElement.remove();
                        }
                    }));

                    addPhraseMeaningBtn.addEventListener('click', event => {
                        searchOverlayContent.style.height = 'auto';
                        phraseMeanings.insertAdjacentHTML('beforeend', `
                            <div class="input-group mb-3">
                                <input type="text" class="form-control phrase-meaning"
                                    placeholder="Meaning in ${language_speaking}">
                                <button class="input-group-append btn btn-outline-danger remove-phrase-meaning-btn" type="button">Remove</button>
                            </div>`)
                        var removePhraseMeaningBtns = document.querySelectorAll('.remove-phrase-meaning-btn');
                        removePhraseMeaningBtns.forEach(removePhraseMeaningBtn => removePhraseMeaningBtn.addEventListener('click', event => {
                            if (phraseMeanings.childElementCount > 1) {
                                removePhraseMeaningBtn.parentElement.remove();
                            }
                        }));
                    })

                    const addPhraseTranBtns = document.querySelectorAll('.add-phrase-tran-btn');
                    savePhraseTranBtn.style.visibility = 'hidden'
                    addPhraseTranBtns.forEach(addPhraseTranBtn => addPhraseTranBtn.addEventListener('click', event => {
                        if (newPhraseTran.style.display == 'block') {
                            newPhraseTran.style.display = 'none'
                            savePhraseTranBtn.style.visibility = 'hidden'
                        }
                        else {
                            newPhraseTran.style.display = 'block';
                            savePhraseTranBtn.style.visibility = 'visible'

                            var newPhraseInput = document.getElementById("phrase-input")
                            newPhraseInput.focus()

                            savePhraseTranBtn.addEventListener('click', e => {
                                var phrMeanings = ''
                                var phrMeaningInputs = document.querySelectorAll('.phrase-meaning');
                                phrMeaningInputs.forEach(phrMeaningInput => {
                                    phrMeanings += phrMeaningInput.value.trim() + '||'
                                })
                                var lastIndex = phrMeanings.lastIndexOf("||");
                                phrMeanings = phrMeanings.substring(0, lastIndex);

                                var alertTrPhrase = document.getElementById("alert-tr-phrase")
                                var newPhr = newPhraseInput.value.trim()
                                if (newPhr.length == 0) {
                                    alertTrPhrase.innerHTML = `
                                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                            <strong>Please enter your new phrase</strong>
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                        </div>`
                                    newPhraseInput.focus()
                                }
                                else if (!isLetter(newPhr.replaceAll(' ', ''))) {
                                    alertTrPhrase.innerHTML = `
                                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                            <strong>Your new phrase can not contain special characters or numbers</strong>
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                        </div>`
                                    newPhraseInput.focus()
                                }
                                else if (newPhr.split(" ").length - 1 < 1) {
                                    alertTrPhrase.innerHTML = `
                                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                        <strong>Your new phrase can not be a word and have atleast 2 words</strong>
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>`
                                    newPhraseInput.focus()
                                }
                                else if (phrMeanings.length == 0) {
                                    alertTrPhrase.innerHTML = `
                                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                            <strong>Please enter Meaning</strong>
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                        </div>`
                                }
                                else {
                                    var newPhrIPA = ''
                                    var newPhrDef = ''
                                    var newPhrNode = ''
                                    if (newPhraseIPA.value.trim().length > 0) {
                                        newPhrIPA = newPhraseIPA.value
                                    }
                                    if (newPhraseDefinition.value.trim().length > 0) {
                                        newPhrDef = newPhraseDefinition.value
                                    }
                                    if (newPhraseNode.value.trim().length > 0) {
                                        newPhrNode = newPhraseNode.value
                                    }

                                    addNewPhraseURL = `/lessons/${lesson_id}/newphrase/add/`
                                    fetch(addNewPhraseURL, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'X-CSRFToken': csrftoken,
                                        },
                                        body: JSON.stringify({
                                            'newphrase': newPhr,
                                            'ipa': newPhrIPA,
                                            'meaning': phrMeanings,
                                            'definition': newPhrDef,
                                            'node': newPhrNode,
                                        }),

                                    }).then(response => response.json())
                                        .then(response => {
                                            const p_success = response.is_success
                                            if (p_success == true) {
                                                const newPhraseId = response.new_phrase_id
                                                const newPhraseTranId = response.new_phrase_tran_id
                                                const newPhraseObj = {
                                                    "phrase_id": newPhraseId, "phrase": newPhr, "ipa": newPhrIPA,
                                                    "meaning": phrMeanings, "definition": newPhrDef, "translation_id": newPhraseTranId,
                                                    "remove": true, "is_missing_tran": false,
                                                }
                                                GeneratePhrasesTBody(newPhraseObj);

                                                alertTrPhrase.innerHTML = `
                                                <div class="alert alert-success alert-dismissible fade show" role="alert">
                                                    <strong>Success!</strong> Added new phrase <strong>${newPhr}</strong> to your lesson
                                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                                </div>`

                                            }
                                            else {
                                                alertTrPhrase.innerHTML = `
                                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                                    <strong>Oops! ${newPhr}</strong> is already exist. Please search again.
                                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                                </div>`
                                                searchPhraseInput.value = newPhr;
                                            }

                                            newPhraseTran.style.display = 'none'
                                            savePhraseTranBtn.style.display = 'none'
                                            //phraseResultsTbody.style.display = 'none'

                                            searchPhraseInput.focus()

                                        })
                                        .catch((error) => {
                                            console.log(error);
                                        });
                                }
                            })
                        }
                    }))
                }

                const addPhraseBtns = document.querySelectorAll('.add-phrase-btn');
                addPhraseBtns.forEach(addPhraseBtn => addPhraseBtn.addEventListener('click', event => {

                    addPhraseURL = `/lessons/${lesson_id}/phrases/${addPhraseBtn.id}/add/`
                    fetch(addPhraseURL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrftoken,
                        },
                    })
                        .then(response => response.json())
                        .then(response => {
                            var phrase = response.phrase
                            phraseSearchAlertDiv.innerHTML = `
                                <div class="alert alert-success alert-dismissible fade show" role="alert">
                                    <strong>Success!</strong> Added phrase <strong>${phrase}</strong> to your lesson
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>  `

                            addPhraseBtn.disabled = true
                            addPhraseBtn.innerText = "Added"
                            addPhraseBtn.classList.add('btn-outline-success');
                            addPhraseBtn.classList.remove('btn-outline-secondary');

                            phraseArray = response.data[0]
                            GeneratePhrasesTBody(phraseArray)
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                }));

            })
            .catch((error) => {
                console.error('Error:', error);
            });


    }

    function searchSentenceFunc() {
        var sentence_q = sentenceQ.value.trim()
        // if (!isAlphaNumeric(sentence_q.replaceAll(' ', ''))) {
        //     sentenceSearchAlertDiv.innerHTML = `
        //     <div class="alert alert-danger alert-dismissible fade show" role="alert">
        //         <strong>Your sentence can not contain special characters</strong>            
        //         <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        //     </div>`
        //     sentenceQ.focus()
        // }

        if (sentence_q.length == 0) {
            sentenceSearchAlertDiv.innerHTML = `
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>You can not search the empty string</strong>           
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>`
            sentenceQ.focus()
        }
        else if (!isLetter(sentence_q.replaceAll(' ', ''))) {
            sentenceSearchAlertDiv.innerHTML = `
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Your sentence can not contain special characters or numbers</strong>           
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>`
            sentenceQ.focus()
        }
        else {
            sentenceResults.style.display = 'block'
            sentenceQ.focus()

            searchSentenceURL = `/lessons/${lesson_id}/sentences/search/`
            fetch(searchSentenceURL, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify({
                    'sentence_q': sentence_q,
                })
            })
                .then(response => response.json())
                .then(response => {
                    sentenceSearchAlertDiv.innerHTML = ``
                    sentenceResultsTbody.innerHTML = ''
                    const sentenceResults = response.data
                    const sentenceExist = response.sentence_exist
                    var new_sentence = `
                    <tr>
                        <td id="newsentence" style="display: none;">
                            <div class="form-group" style="text-align: left;">
                                <label for="sentence-meanings">*New sentence:</label>
                                <input type="text" class="form-control" id="sentence-input" value="${sentence_q}">
                                <label for="sentence-ipa">IPA:</label>
                                <input type="text" class="form-control" id="sentence-ipa">
                                <label for="sentence-meanings">*Meaning:</label>
                                <button id="add-sentence-meaning-btn" class="btn btn-outline-success">Add meaning</button>
                                <div id="sentence-meanings">
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control sentence-meaning"
                                            placeholder="Meaning in ${language_speaking}">
                                        <button class="input-group-append btn btn-outline-danger remove-sentence-meaning-btn" type="button">Remove</button>
                                    </div>
                                </div>
                                <label for="sentence-node">Node:</label>
                                <input type="text" class="form-control" id="sentence-node" >
                            </div>
                        </td>
                        <td>
                            <button type="submit" id="save-newsentence-btn" class="btn btn-outline-secondary">Save</button>
                        </td>
                    </tr>`

                    if (sentenceExist) {
                        sentenceResultsTbody.innerHTML = ``
                    }
                    //  && sentenceQ.value.trim().split(" ").length - 1 
                    else if (sentence_q.indexOf(' ') >= 0) {
                        sentenceResultsTbody.innerHTML = `
                        <tr id="alert-tr-sentence">
                            <td>
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    This course does not have any sentence like <strong>${sentence_q}</strong>
                                    <button class="add-newsentence-btn btn btn-secondary" style="margin-left: 20px;">Add new sentence?</button>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            </td>
                        </tr>`
                    }

                    if (sentenceResults.length > 0) {
                        sentenceResults.map(stc => {
                            if (stc.learning) {
                                sentenceResultsTbody.innerHTML += `
                                <tr>
                                    <td>
                                        <a class="link-secondary" href="/phrases/${stc.id}/detail/">${stc.sentence}</a>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-success" disabled>Added</button>
                                    </td>
                                </tr>`
                            }
                            else {
                                sentenceResultsTbody.innerHTML += `
                                <tr>
                                    <td>
                                        <a class="link-secondary" href="/phrases/${stc.id}/detail/">${stc.sentence}</a>
                                    </td>
                                    <td>
                                        <button class="add-sentence-btn btn btn-outline-secondary" id="${stc.id}" title="Add to my lesson">Add</button>
                                    </td>
                                </tr>`
                            }
                        })
                    }
                    else {
                        sentenceResultsTbody.innerHTML = `
                        <tr id="alert-tr-sentence">
                            <td>
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    There is no sentence contain <strong>${sentence_q}</strong>
                                    <button class="add-newsentence-btn btn btn-secondary">Add new sentence?</button>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            </td>
                        </tr>`

                    }

                    sentenceResultsTbody.innerHTML += new_sentence
                    var newSentenceIPA = document.getElementById("sentence-ipa")
                    var newSentenceNode = document.getElementById("sentence-node")

                    var newSentenceTran = document.getElementById("newsentence")
                    var saveNewSentenceBtn = document.getElementById("save-newsentence-btn")

                    var sentenceMeanings = document.getElementById("sentence-meanings")
                    var addSentenceMeaningBtn = document.getElementById("add-sentence-meaning-btn")
                    var removeSentenceMeaningBtns = document.querySelectorAll('.remove-sentence-meaning-btn');
                    removeSentenceMeaningBtns.forEach(removeSentenceMeaningBtn => removeSentenceMeaningBtn.addEventListener('click', event => {
                        if (sentenceMeanings.childElementCount > 1) {
                            removeSentenceMeaningBtn.parentElement.remove();
                        }
                    }));

                    addSentenceMeaningBtn.addEventListener('click', event => {
                        searchOverlayContent.style.height = 'auto';
                        sentenceMeanings.insertAdjacentHTML('beforeend', `
                        <div class="input-group mb-3">
                            <input type="text" class="form-control sentence-meaning"
                                placeholder="Meaning in ${language_speaking}">
                            <button class="input-group-append btn btn-outline-danger remove-sentence-meaning-btn" type="button">Remove</button>
                        </div>`)
                        var removeSentenceMeaningBtns = document.querySelectorAll('.remove-sentence-meaning-btn');
                        removeSentenceMeaningBtns.forEach(removeSentenceMeaningBtn => removeSentenceMeaningBtn.addEventListener('click', event => {
                            if (sentenceMeanings.childElementCount > 1) {
                                removeSentenceMeaningBtn.parentElement.remove();
                            }
                        }));
                    })

                    const addNewSentenceBtns = document.querySelectorAll('.add-newsentence-btn');
                    saveNewSentenceBtn.style.visibility = 'hidden'
                    addNewSentenceBtns.forEach(addNewSentenceBtn => addNewSentenceBtn.addEventListener('click', event => {
                        if (newSentenceTran.style.display == 'block') {
                            newSentenceTran.style.display = 'none'
                            saveNewSentenceBtn.style.visibility = 'hidden'

                        }
                        else {
                            newSentenceTran.style.display = 'block';
                            saveNewSentenceBtn.style.visibility = 'visible'

                            var newSentenceInput = document.getElementById("sentence-input")
                            newSentenceInput.focus()

                            saveNewSentenceBtn.addEventListener('click', e => {
                                var stcMeanings = ''
                                var stcMeaningInputs = document.querySelectorAll('.sentence-meaning');
                                stcMeaningInputs.forEach(stcMeaningInput => {
                                    stcMeanings += stcMeaningInput.value.trim() + '||'
                                })
                                var lastIndex = stcMeanings.lastIndexOf("||");
                                stcMeanings = stcMeanings.substring(0, lastIndex);

                                var newStc = newSentenceInput.value.trim()
                                var alertTrSentence = document.getElementById("alert-tr-sentence")
                                if (newStc.length == 0) {
                                    alertTrSentence.innerHTML = `
                                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                        <strong>Please enter your new sentence</strong>
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>`
                                    newSentenceInput.focus()
                                }
                                else if (!isLetter(newStc.replaceAll(' ', ''))) {
                                    alertTrSentence.innerHTML = `
                                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                        <strong>Your new sentence can not contain special characters or numbers</strong>           
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>`
                                    newSentenceInput.focus()
                                }
                                else if (newStc.split(" ").length - 1 < 3) {
                                    alertTrSentence.innerHTML = `
                                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                        <strong>Your new sentence can not be a word and have atleast 4 words</strong>
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>`
                                    newSentenceInput.focus()
                                }
                                else if (stcMeanings.length == 0) {
                                    alertTrSentence.innerHTML = `
                                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                        <strong>Please enter meaning</strong>     
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>`
                                }
                                else {
                                    var newStcIPA = ''
                                    if (newSentenceIPA.value.trim().length > 0)
                                        newStcIPA = newSentenceIPA.value
                                    var newStcNode = ''
                                    if (newSentenceNode.value.trim().length > 0)
                                        newStcNode = newSentenceNode.value

                                    addNewSentenceURL = `/lessons/${lesson_id}/newsentence/add/`
                                    fetch(addNewSentenceURL, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                            'X-CSRFToken': csrftoken,
                                        },
                                        body: JSON.stringify({
                                            'newsentence': newStc,
                                            'ipa': newStcIPA,
                                            'meaning': stcMeanings,
                                            'node': newStcNode,
                                        }),

                                    }).then(response => response.json())
                                        .then(response => {
                                            const e_success = response.is_success
                                            if (e_success) {
                                                const newSentenceId = response.new_sentence_id
                                                const sentenceObj = {
                                                    "id": newSentenceId, "sentence": newStc, 'ipa': newStcIPA, "meaning": stcMeanings, "is_missing_tran": false,
                                                }
                                                GenerateSentencesTBody(sentenceObj);

                                                alertTrSentence.innerHTML = `
                                            <div class="alert alert-success alert-dismissible fade show" role="alert">
                                                <strong>Success!</strong> Added new sentence <strong>${newStc}</strong> to your lesson
                                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                            <div>`
                                            }
                                            else {
                                                alertTrSentence.innerHTML = `
                                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                                <strong>Oops!</strong> You already have an sentence <strong>${newStc}</strong>. Please search again.
                                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                            <div>`
                                                sentenceQ.value = newStc;
                                            }

                                            newSentenceTran.style.display = 'none'
                                            saveNewSentenceBtn.style.display = 'none'
                                            //sentenceResultsTbody.style.display = 'none'

                                            sentenceQ.focus()
                                        })
                                        .catch((error) => {
                                            console.log(error);
                                        });
                                }
                            })
                        }
                    }))

                    const addSentenceBtns = document.querySelectorAll('.add-sentence-btn');
                    addSentenceBtns.forEach(addSentenceBtn => addSentenceBtn.addEventListener('click', event => {

                        addSentenceURL = `/lessons/${lesson_id}/sentences/${addSentenceBtn.id}/add/`
                        fetch(addSentenceURL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': csrftoken,
                            },
                        })
                            .then(response => response.json())
                            .then(response => {
                                var sentence = response.sentence
                                sentenceSearchAlertDiv.innerHTML = `
                                <div class="alert alert-success alert-dismissible fade show" role="alert">
                                    <strong>Success!</strong> Added sentence <strong>${sentence}</strong> to your lesson
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>  `
                                addSentenceBtn.disabled = true
                                addSentenceBtn.innerText = "Added"
                                addSentenceBtn.classList.add('btn-outline-success');
                                addSentenceBtn.classList.remove('btn-outline-secondary');

                                sentenceArray = response.data[0]
                                GenerateSentencesTBody(sentenceArray)
                            })
                            .catch((error) => {
                                console.error('Error:', error);
                            });
                    }));
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }
    }

</script>
{% endblock %}